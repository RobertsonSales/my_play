<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="description" content="Gerenciador de M√≠dias - Organize e reproduza suas m√≠dias online e locais">
    <meta name="theme-color" content="#6366f1">
    <meta name="color-scheme" content="light dark">
    <title>Arm√°rio de M√≠dias Pro</title>
    
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://img.youtube.com">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
          integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" 
          crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <style>
        :root {
            --primary-color: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary-color: #10b981;
            --secondary-dark: #059669;
            --danger-color: #ef4444;
            --danger-dark: #dc2626;
            --warning-color: #f59e0b;
            --warning-dark: #d97706;
            --info-color: #3b82f6;
            --info-dark: #2563eb;
            --success-color: #22c55e;
            --light-color: #f9fafb;
            --dark-color: #1f2937;
            --gray-color: #6b7280;
            --gray-light: #9ca3af;
            --border-color: #e5e7eb;
            --white: #ffffff;
            --bg-gradient-start: #667eea;
            --bg-gradient-end: #764ba2;
            --sidebar-width: 300px;
            --header-height: 70px;
            --border-radius: 12px;
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --box-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 300ms cubic-bezier(0.4, 0, 0.2, 1);
            --z-modal: 1000;
            --z-toast: 2000;
            --z-loader: 3000;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --light-color: #1f2937;
                --dark-color: #f9fafb;
                --border-color: #374151;
                --white: #111827;
                --gray-color: #9ca3af;
            }
        }

        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        
        html { font-size: 16px; scroll-behavior: smooth; -webkit-text-size-adjust: 100%; }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: var(--dark-color);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        *:focus-visible {
            outline: 3px solid var(--primary-color);
            outline-offset: 2px;
            border-radius: 4px;
        }

        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--primary-color);
            color: white;
            padding: 8px 16px;
            z-index: 3001;
            transition: top 150ms;
        }
        .skip-link:focus { top: 0; }

        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            box-shadow: var(--box-shadow);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 200;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary-color);
            text-decoration: none;
        }

        .logo-icon { font-size: 2rem; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }

        .header-actions { display: flex; gap: 12px; align-items: center; }

        .sidebar {
            position: fixed;
            left: 0;
            top: var(--header-height);
            width: var(--sidebar-width);
            height: calc(100vh - var(--header-height));
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            box-shadow: var(--box-shadow-lg);
            z-index: 200;
            transition: transform 300ms;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
        }

        .sidebar.hidden { transform: translateX(-100%); }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 24px;
        }

        .sidebar-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sidebar-stats {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .sidebar-search { margin-bottom: 20px; }
        
        .sidebar-search input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            transition: 150ms;
            background: var(--light-color);
        }
        
        .sidebar-search input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .playlist-list { list-style: none; flex: 1; overflow-y: auto; margin: 0 -24px; padding: 0 24px; }
        
        .playlist-item {
            padding: 14px 16px;
            margin-bottom: 8px;
            background: var(--light-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: 150ms;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-left: 4px solid transparent;
        }
        
        .playlist-item:hover {
            background: #e5e7eb;
            transform: translateX(4px);
            box-shadow: var(--box-shadow);
        }
        
        .playlist-item.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border-left-color: var(--secondary-color);
        }

        .playlist-info { flex: 1; min-width: 0; }
        
        .playlist-name {
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.95rem;
        }
        
        .playlist-stats {
            font-size: 0.8rem;
            color: var(--gray-color);
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .playlist-item.active .playlist-stats { color: rgba(255, 255, 255, 0.9); }

        .playlist-actions {
            display: flex;
            gap: 6px;
            opacity: 0;
            transition: opacity 150ms;
        }
        
        .playlist-item:hover .playlist-actions { opacity: 1; }

        .btn-action {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            transition: 150ms;
            color: var(--gray-color);
            box-shadow: var(--box-shadow);
        }
        
        .btn-action:hover {
            background: var(--light-color);
            transform: scale(1.1);
            color: var(--dark-color);
        }
        
        .btn-action.delete:hover { background: var(--danger-color); color: white; }

        .backup-section {
            margin-top: auto;
            padding-top: 20px;
            border-top: 2px solid var(--border-color);
        }
        
        .backup-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .backup-actions { display: flex; gap: 8px; flex-wrap: wrap; }

        .main-content {
            margin-left: var(--sidebar-width);
            padding: 30px;
            padding-top: calc(var(--header-height) + 30px);
            transition: margin-left 300ms;
            min-height: 100vh;
        }
        
        .main-content.full-width { margin-left: 0; }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .section-title {
            font-size: 2rem;
            color: white;
            font-weight: 800;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-actions { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }

        .search-box { position: relative; }
        
        .search-box input {
            padding: 12px 40px 12px 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.95);
            font-size: 0.95rem;
            min-width: 250px;
            transition: 150ms;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: white;
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.2);
        }
        
        .search-box i {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-color);
        }

        .sort-controls {
            display: flex;
            gap: 4px;
            background: rgba(255, 255, 255, 0.95);
            padding: 6px;
            border-radius: 25px;
            box-shadow: var(--box-shadow);
        }
        
        .sort-btn {
            padding: 10px 16px;
            border: none;
            background: transparent;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: 150ms;
            color: var(--gray-color);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .sort-btn:hover { background: var(--light-color); color: var(--dark-color); }
        
        .sort-btn.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: var(--box-shadow);
        }

        .stats-badge {
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            color: var(--primary-color);
            box-shadow: var(--box-shadow);
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
            box-shadow: var(--box-shadow-lg);
        }
        
        .empty-icon { font-size: 5rem; margin-bottom: 24px; opacity: 0.5; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        
        .empty-text { font-size: 1.4rem; color: var(--dark-color); margin-bottom: 12px; font-weight: 600; }
        .empty-subtext { color: var(--gray-color); font-size: 1rem; max-width: 400px; margin: 0 auto; }

        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
            margin-top: 24px;
        }
        
        .media-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: 300ms;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            position: relative;
            border: 2px solid transparent;
        }
        
        .media-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--box-shadow-lg);
            border-color: var(--primary-light);
        }
        
        .media-thumbnail {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            position: relative;
            overflow: hidden;
        }
        
        .media-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 500ms;
        }
        
        .media-card:hover .media-thumbnail img { transform: scale(1.1); }
        
        .play-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 1.5rem;
            transition: transform 300ms;
            box-shadow: var(--box-shadow-lg);
        }
        
        .media-card:hover .play-overlay { transform: translate(-50%, -50%) scale(1); }

        .media-info { padding: 20px; flex: 1; display: flex; flex-direction: column; }
        
        .media-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: var(--dark-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .media-description {
            color: var(--gray-color);
            font-size: 0.9rem;
            margin-bottom: 16px;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            flex: 1;
        }
        
        .media-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .media-meta { display: flex; gap: 8px; font-size: 0.85rem; color: var(--gray-color); flex-wrap: wrap; }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-online { background: var(--info-color); color: white; }
        .badge-local { background: var(--primary-color); color: white; }
        .badge-video { background: var(--danger-color); color: white; }
        .badge-audio { background: var(--secondary-color); color: white; }

        .btn-share {
            background: var(--success-color);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 150ms;
            box-shadow: var(--box-shadow);
        }
        
        .btn-share:hover { transform: scale(1.1) rotate(15deg); box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4); }

        .player-section {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: var(--box-shadow-lg);
            margin-top: 40px;
            position: relative;
            overflow: hidden;
        }
        
        .player-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        }
        
        .player-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 24px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .current-track-info {
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 24px;
            display: none;
            border-left: 4px solid var(--primary-color);
        }
        
        .current-track-info.active { display: block; }
        
        .current-track-name { font-weight: 700; font-size: 1.2rem; color: var(--dark-color); margin-bottom: 8px; }
        .current-track-meta { font-size: 0.95rem; color: var(--gray-color); }

        .media-players { display: flex; flex-direction: column; gap: 20px; margin-bottom: 24px; }
        
        #videoPlayer, #audioPlayer {
            width: 100%;
            border-radius: var(--border-radius);
            display: none;
            background: black;
            max-height: 60vh;
        }
        
        #embedPlayer {
            width: 100%;
            height: 500px;
            border: none;
            border-radius: var(--border-radius);
            display: none;
            background: black;
        }

        .player-controls {
            display: flex;
            justify-content: center;
            gap: 16px;
            flex-wrap: wrap;
            margin-bottom: 24px;
        }
        
        .player-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 150ms;
            box-shadow: var(--box-shadow);
        }
        
        .player-btn:hover:not(:disabled) { transform: scale(1.1); box-shadow: var(--box-shadow-lg); }
        .player-btn:disabled { opacity: 0.4; cursor: not-allowed; background: var(--gray-light); }
        .player-btn.shuffle-active { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); animation: pulse 2s infinite; }
        .player-btn.primary { width: 70px; height: 70px; font-size: 1.5rem; }

        .progress-section {
            display: none;
            background: var(--light-color);
            padding: 20px;
            border-radius: var(--border-radius);
        }
        
        .progress-section.active { display: block; }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
            transition: height 150ms;
        }
        
        .progress-bar:hover { height: 12px; }
        
        .progress {
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            transition: width 0.1s linear;
            border-radius: 4px;
        }
        
        .time-display {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
            font-size: 0.9rem;
            color: var(--gray-color);
            font-weight: 600;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 16px;
        }
        
        .volume-slider {
            flex: 1;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: #e5e7eb;
            border-radius: 3px;
            outline: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            transition: 150ms;
        }
        
        .volume-slider::-webkit-slider-thumb:hover { transform: scale(1.2); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2); }

        .media-list-view { display: none; margin-top: 30px; }
        .media-list-view.active { display: block; }
        
        .media-list-table {
            width: 100%;
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--box-shadow);
            border-collapse: collapse;
        }
        
        .media-list-table thead {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
        }
        
        .media-list-table th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .media-list-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }
        
        .media-list-table tbody tr { transition: 150ms; }
        .media-list-table tbody tr:hover { background: var(--light-color); }
        .media-list-table tbody tr.active { background: rgba(99, 102, 241, 0.1); border-left: 3px solid var(--primary-color); }
        
        .table-actions { display: flex; gap: 8px; }

        .btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: 150ms;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            min-width: 140px;
            justify-content: center;
            box-shadow: var(--box-shadow);
            text-decoration: none;
        }
        
        .btn:hover { transform: translateY(-2px); box-shadow: var(--box-shadow-lg); }
        .btn:active { transform: translateY(0); }
        
        .btn-secondary { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .btn-danger { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .btn-warning { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        
        .btn-light {
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }
        
        .btn-light:hover { background: var(--light-color); }
        .btn-block { width: 100%; }
        .btn-sm { padding: 8px 16px; font-size: 0.85rem; min-width: auto; }

        .fab-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 100;
            display: none;
        }
        
        .fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--box-shadow-lg);
            transition: 150ms;
        }
        
        .fab:hover { transform: scale(1.1) rotate(90deg); }
        
        .fab-menu {
            position: absolute;
            bottom: 70px;
            right: 0;
            display: flex;
            flex-direction: column;
            gap: 12px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: 300ms;
        }
        
        .fab-menu.show { opacity: 1; visibility: visible; transform: translateY(0); }
        
        .fab-item { display: flex; align-items: center; gap: 12px; white-space: nowrap; }
        
        .fab-item .btn { min-width: auto; width: 48px; height: 48px; border-radius: 50%; padding: 0; }
        
        .fab-label {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: var(--z-modal);
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 300ms;
            padding: 20px;
        }
        
        .modal.show { display: flex; opacity: 1; }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9) translateY(20px);
            transition: transform 300ms;
            box-shadow: var(--box-shadow-lg);
        }
        
        .modal.show .modal-content { transform: scale(1) translateY(0); }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            border-bottom: 2px solid var(--border-color);
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            position: sticky;
            top: 0;
            z-index: 1;
        }
        
        .modal-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--gray-color);
            transition: 150ms;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .close-modal:hover { background: var(--light-color); color: var(--danger-color); transform: rotate(90deg); }
        
        .modal-body { padding: 24px; }

        .form-group { margin-bottom: 24px; }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
            font-size: 0.95rem;
        }
        
        .form-group label .required { color: var(--danger-color); margin-left: 4px; }
        
        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: 150ms;
            background: white;
            font-family: inherit;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }
        
        select.form-control {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 40px;
        }
        
        textarea.form-control { resize: vertical; min-height: 100px; }
        
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        .form-note {
            font-size: 0.85rem;
            color: var(--gray-color);
            margin-top: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .validation-error {
            color: var(--danger-color);
            font-size: 0.85rem;
            margin-top: 6px;
            display: none;
            font-weight: 500;
            align-items: center;
            gap: 6px;
        }
        
        .validation-error.show { display: flex; }
        
        .input-group { display: flex; gap: 0; }
        .input-group .form-control { border-radius: var(--border-radius) 0 0 var(--border-radius); }
        .input-group .btn { border-radius: 0 var(--border-radius) var(--border-radius) 0; min-width: auto; }

        .url-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .url-status.valid { color: var(--success-color); }
        .url-status.invalid { color: var(--danger-color); }
        .url-status.checking { color: var(--warning-color); }

        .folder-selection-area {
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            padding: 30px;
            border-radius: var(--border-radius);
            text-align: center;
            border: 2px dashed var(--border-color);
            transition: 150ms;
        }
        
        .folder-selection-area:hover {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%);
        }
        
        .folder-icon { font-size: 3rem; color: var(--primary-color); margin-bottom: 16px; }
        
        .folder-status {
            margin-top: 16px;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .folder-status.success { background: #d1fae5; color: var(--secondary-dark); }
        .folder-status.error { background: #fee2e2; color: var(--danger-dark); }
        .folder-status.info { background: #dbeafe; color: var(--info-dark); }

        .file-list-preview {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 16px;
            background: white;
            border-radius: 8px;
            padding: 12px;
            border: 1px solid var(--border-color);
        }
        
        .file-list-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.85rem;
        }
        
        .file-list-item:last-child { border-bottom: none; }

        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: var(--z-toast);
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 400px;
        }
        
        .toast {
            background: white;
            padding: 16px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-lg);
            display: flex;
            align-items: flex-start;
            gap: 12px;
            transform: translateX(120%);
            transition: transform 300ms;
            border-left: 4px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .toast.show { transform: translateX(0); }
        
        .toast.success { border-left-color: var(--success-color); color: var(--success-color); }
        .toast.error { border-left-color: var(--danger-color); color: var(--danger-color); }
        .toast.warning { border-left-color: var(--warning-color); color: var(--warning-color); }
        .toast.info { border-left-color: var(--info-color); color: var(--info-color); }
        
        .toast-icon { font-size: 1.3rem; flex-shrink: 0; }
        .toast-content { flex: 1; }
        .toast-message { color: var(--gray-color); font-size: 0.9rem; line-height: 1.4; }
        
        .toast-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--gray-color);
            transition: 150ms;
            padding: 4px;
            margin: -4px;
        }
        
        .toast-close:hover { color: var(--danger-color); }

        .loader-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: var(--z-loader);
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 24px;
        }
        
        .loader-overlay.show { display: flex; }
        
        .loader {
            width: 60px;
            height: 60px;
            position: relative;
        }
        
        .loader::before, .loader::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        
        .loader::before { width: 100%; height: 100%; background: var(--primary-color); opacity: 0.6; }
        .loader::after { width: 100%; height: 100%; background: var(--secondary-color); opacity: 0.6; animation-delay: 0.5s; }
        
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.8; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        .loader-text { color: white; font-size: 1.1rem; font-weight: 600; text-align: center; }
        .loader-subtext { color: rgba(255, 255, 255, 0.8); font-size: 0.9rem; }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        @media (prefers-contrast: high) {
            :root { --primary-color: #0000ff; --primary-dark: #0000cc; --secondary-color: #008000; --danger-color: #ff0000; }
            .btn, .player-btn, .btn-action { border: 2px solid currentColor; }
            .media-card { border: 3px solid black; }
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        @media (max-width: 768px) {
            :root { --sidebar-width: 100%; --header-height: 60px; }
            .sidebar { width: 100%; transform: translateX(-100%); }
            .sidebar.show { transform: translateX(0); }
            .main-content { margin-left: 0; padding: 20px; padding-top: calc(var(--header-height) + 20px); }
            .section-header { flex-direction: column; align-items: flex-start; }
            .section-title { font-size: 1.5rem; }
            .media-grid { grid-template-columns: 1fr; gap: 16px; }
            .form-row { grid-template-columns: 1fr; }
            #embedPlayer { height: 250px; }
            .modal-content { max-width: 100%; max-height: 95vh; }
            .toast-container { left: 16px; right: 16px; max-width: none; }
            .fab-container { display: block; }
            .toggle-sidebar { display: flex; }
            .header-actions .btn span { display: none; }
            .header-actions .btn { min-width: auto; padding: 10px; border-radius: 50%; width: 44px; height: 44px; }
        }

        @media (max-width: 480px) {
            .section-actions { width: 100%; }
            .search-box { width: 100%; }
            .search-box input { min-width: 100%; width: 100%; }
            .media-thumbnail { height: 160px; }
            .backup-actions { flex-direction: column; }
            .backup-actions .btn { width: 100%; }
        }

        .toggle-sidebar {
            display: none;
            background: var(--primary-color);
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            transition: 150ms;
            box-shadow: var(--box-shadow);
            margin-right: 8px;
        }
        
        .toggle-sidebar:hover { background: var(--primary-dark); transform: scale(1.1); }
    </style>
</head>
<body>
    <a href="#mainContent" class="skip-link">Pular para conte√∫do principal</a>

    <header role="banner">
        <div style="display: flex; align-items: center; gap: 12px;">
            <button class="toggle-sidebar" id="toggleSidebar" aria-label="Alternar menu lateral" aria-expanded="false" aria-controls="sidebar">
                <i class="fas fa-bars" aria-hidden="true"></i>
            </button>
            <a href="#" class="logo" aria-label="Arm√°rio de M√≠dias - P√°gina inicial">
                <span class="logo-icon" aria-hidden="true">üìö</span>
                <span>Arm√°rio de M√≠dias</span>
            </a>
        </div>
        <div class="header-actions">
            <button class="btn" id="newPlaylistBtn" aria-label="Criar nova playlist">
                <i class="fas fa-plus" aria-hidden="true"></i>
                <span class="sr-only">Nova Playlist</span>
            </button>
            <button class="btn btn-secondary" id="addItemBtn" aria-label="Adicionar novo item">
                <i class="fas fa-plus-circle" aria-hidden="true"></i>
                <span class="sr-only">Adicionar Item</span>
            </button>
        </div>
    </header>

    <aside class="sidebar" id="sidebar" role="navigation" aria-label="Menu de playlists">
        <div class="sidebar-header">
            <div class="sidebar-title">
                <i class="fas fa-list" aria-hidden="true"></i>
                <span>Playlists</span>
            </div>
            <div class="sidebar-stats" id="totalPlaylists" aria-live="polite">0</div>
        </div>

        <div class="sidebar-search">
            <input type="text" id="playlistSearch" placeholder="Buscar playlists..." 
                   aria-label="Buscar playlists" autocomplete="off">
        </div>

        <ul class="playlist-list" id="playlistList" role="list"></ul>

        <div class="backup-section">
            <div class="backup-title">
                <i class="fas fa-database" aria-hidden="true"></i>
                <span>Backup de Dados</span>
            </div>
            <div class="backup-actions">
                <button class="btn btn-sm btn-secondary btn-block" id="exportBtn" 
                        aria-label="Exportar dados para arquivo JSON">
                    <i class="fas fa-download" aria-hidden="true"></i>
                    <span>Exportar</span>
                </button>
                <button class="btn btn-sm btn-light btn-block" id="importBtn"
                        aria-label="Importar dados de arquivo JSON">
                    <i class="fas fa-upload" aria-hidden="true"></i>
                    <span>Importar</span>
                </button>
                <input type="file" id="importFile" accept=".json" style="display: none;" 
                       aria-label="Selecionar arquivo JSON para importar">
            </div>
        </div>
    </aside>

    <main class="main-content" id="mainContent" role="main">
        <div class="section-header">
            <h1 class="section-title" id="currentPlaylistTitle">
                <i class="fas fa-film" aria-hidden="true"></i>
                <span>Todas as M√≠dias</span>
            </h1>
            <div class="section-actions">
                <div class="search-box">
                    <input type="text" id="mediaSearch" placeholder="Buscar m√≠dias..."
                           aria-label="Buscar m√≠dias por t√≠tulo ou descri√ß√£o" autocomplete="off">
                    <i class="fas fa-search" aria-hidden="true"></i>
                </div>
                <div class="sort-controls" role="radiogroup" aria-label="Controles de ordena√ß√£o">
                    <button class="sort-btn active" data-sort="name" role="radio" aria-checked="true" 
                            aria-label="Ordenar por nome">
                        <i class="fas fa-sort-alpha-down" aria-hidden="true"></i>
                        <span>Nome</span>
                    </button>
                    <button class="sort-btn" data-sort="date" role="radio" aria-checked="false"
                            aria-label="Ordenar por data">
                        <i class="fas fa-calendar" aria-hidden="true"></i>
                        <span>Data</span>
                    </button>
                    <button class="sort-btn" data-sort="type" role="radio" aria-checked="false"
                            aria-label="Ordenar por tipo">
                        <i class="fas fa-filter" aria-hidden="true"></i>
                        <span>Tipo</span>
                    </button>
                </div>
                <span class="stats-badge" id="totalItems" aria-live="polite">0 itens</span>
            </div>
        </div>

        <div id="mediaContainer" role="region" aria-label="Lista de m√≠dias">
            <div class="empty-state">
                <div class="empty-icon" aria-hidden="true">üìÅ</div>
                <div class="empty-text">Nenhuma m√≠dia encontrada</div>
                <div class="empty-subtext">Adicione links online ou pastas locais para come√ßar</div>
            </div>
        </div>

        <div class="media-list-view" id="mediaListView" role="region" aria-label="Visualiza√ß√£o de lista e player">
            <section class="player-section" aria-label="Player de m√≠dia">
                <h2 class="player-title">
                    <i class="fas fa-play-circle" aria-hidden="true"></i>
                    <span>Reprodutor</span>
                </h2>
                
                <div class="current-track-info" id="currentTrackInfo" aria-live="polite" aria-atomic="true">
                    <div class="current-track-name" id="currentTrackName">-</div>
                    <div class="current-track-meta" id="currentTrackMeta">-</div>
                </div>
                <div class="media-players">
                    <video id="videoPlayer" controls playsinline 
                           aria-label="Player de v√≠deo" 
                           poster="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='640' height='360' viewBox='0 0 640 360'%3E%3Crect fill='%23f3f4f6' width='640' height='360'/%3E%3Ctext fill='%239ca3af' font-family='sans-serif' font-size='24' dy='10.5' font-weight='bold' x='50%25' y='50%25' text-anchor='middle'%3EV√≠deo%3C/text%3E%3C/svg%3E">
                        Seu navegador n√£o suporta o elemento de v√≠deo.
                    </video>
                    <audio id="audioPlayer" controls 
                           aria-label="Player de √°udio">
                        Seu navegador n√£o suporta o elemento de √°udio.
                    </audio>
                    <iframe id="embedPlayer" allowfullscreen 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            aria-label="Player embarcado de v√≠deo externo"
                            title="Player de v√≠deo externo">
                    </iframe>
                </div>

                <div class="player-controls" role="group" aria-label="Controles de reprodu√ß√£o">
                    <button class="player-btn" id="prevBtn" disabled 
                            title="Anterior (Alt + ‚Üê)" aria-label="Reproduzir faixa anterior">
                        <i class="fas fa-step-backward" aria-hidden="true"></i>
                    </button>
                    <button class="player-btn primary" id="playBtn" disabled 
                            title="Play/Pause (Espa√ßo)" aria-label="Play ou pausar reprodu√ß√£o">
                        <i class="fas fa-play" aria-hidden="true"></i>
                    </button>
                    <button class="player-btn" id="nextBtn" disabled 
                            title="Pr√≥ximo (Alt + ‚Üí)" aria-label="Reproduzir pr√≥xima faixa">
                        <i class="fas fa-step-forward" aria-hidden="true"></i>
                    </button>
                    <button class="player-btn" id="shuffleBtn" 
                            title="Embaralhar (S)" aria-label="Alternar modo aleat√≥rio">
                        <i class="fas fa-random" aria-hidden="true"></i>
                    </button>
                    <button class="player-btn" id="repeatBtn" 
                            title="Repetir (R)" aria-label="Alternar modo de repeti√ß√£o">
                        <i class="fas fa-redo" aria-hidden="true"></i>
                    </button>
                    <button class="player-btn" id="playAllBtn" 
                            title="Reproduzir Tudo" aria-label="Reproduzir todas as faixas da pasta">
                        <i class="fas fa-play" aria-hidden="true"></i>
                        <span style="font-size: 0.7rem; margin-left: 4px;">ALL</span>
                    </button>
                </div>

                <div class="progress-section" id="progressSection">
                    <div class="progress-bar" id="progressBarContainer" 
                         role="slider" aria-label="Progresso da reprodu√ß√£o"
                         aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"
                         tabindex="0">
                        <div class="progress" id="progressBar" style="width: 0%"></div>
                    </div>
                    <div class="time-display">
                        <span id="currentTime">0:00</span>
                        <span id="duration">0:00</span>
                    </div>
                    
                    <div class="volume-control">
                        <i class="fas fa-volume-up" id="volumeIcon" aria-hidden="true"></i>
                        <input type="range" class="volume-slider" id="volumeSlider" 
                               min="0" max="100" value="100" 
                               aria-label="Volume">
                        <span id="volumeValue" style="font-size: 0.85rem; color: var(--gray-color); min-width: 36px;">100%</span>
                    </div>
                </div>
            </section>

            <div style="overflow-x: auto; margin-top: 24px;">
                <table class="media-list-table" role="table" aria-label="Lista de faixas na playlist">
                    <thead>
                        <tr>
                            <th scope="col" style="width: 60px;"><i class="fas fa-hashtag" aria-hidden="true"></i> <span class="sr-only">N√∫mero</span></th>
                            <th scope="col"><i class="fas fa-file" aria-hidden="true"></i> Nome</th>
                            <th scope="col"><i class="fas fa-info-circle" aria-hidden="true"></i> Tipo</th>
                            <th scope="col" style="width: 120px;"><i class="fas fa-cog" aria-hidden="true"></i> A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="mediaListBody"></tbody>
                </table>
            </div>
        </div>
    </main>

    <div class="fab-container" id="fabContainer">
        <div class="fab-menu" id="fabMenu">
            <div class="fab-item">
                <span class="fab-label">Nova Playlist</span>
                <button class="btn" id="fabNewPlaylist" aria-label="Criar nova playlist">
                    <i class="fas fa-plus" aria-hidden="true"></i>
                </button>
            </div>
            <div class="fab-item">
                <span class="fab-label">Adicionar Item</span>
                <button class="btn btn-secondary" id="fabAddItem" aria-label="Adicionar novo item">
                    <i class="fas fa-plus-circle" aria-hidden="true"></i>
                </button>
            </div>
        </div>
        <button class="fab" id="fabToggle" aria-label="Abrir menu de a√ß√µes" aria-expanded="false">
            <i class="fas fa-plus" aria-hidden="true"></i>
        </button>
    </div>

    <div class="modal" id="addItemModal" role="dialog" aria-labelledby="addItemModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="addItemModalTitle">
                    <i class="fas fa-plus" aria-hidden="true"></i>
                    <span>Adicionar Item</span>
                </h3>
                <button class="close-modal" id="closeAddItemModal" aria-label="Fechar modal">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addItemForm" novalidate>
                    <div class="form-group">
                        <label for="itemType">Tipo de Item <span class="required" aria-label="obrigat√≥rio">*</span></label>
                        <select id="itemType" class="form-control" required aria-required="true">
                            <option value="online">üîó Link Online</option>
                            <option value="local">üìÅ Pasta Local</option>
                        </select>
                    </div>

                    <div id="onlineForm">
                        <div class="form-group">
                            <label for="mediaTitle">T√≠tulo <span class="required" aria-label="obrigat√≥rio">*</span></label>
                            <input type="text" id="mediaTitle" class="form-control" 
                                   placeholder="Ex: Meu V√≠deo Favorito"
                                   required aria-required="true" autocomplete="off">
                            <div class="validation-error" id="mediaTitleError">
                                <i class="fas fa-exclamation-circle" aria-hidden="true"></i>
                                <span>T√≠tulo √© obrigat√≥rio</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="mediaUrl">URL <span class="required" aria-label="obrigat√≥rio">*</span></label>
                            <div class="input-group">
                                <input type="url" id="mediaUrl" class="form-control" 
                                       placeholder="https://exemplo.com/video.mp4"
                                       required aria-required="true" autocomplete="off">
                                <button type="button" class="btn btn-sm" id="validateUrlBtn" 
                                        aria-label="Validar URL" title="Validar URL">
                                    <i class="fas fa-check" aria-hidden="true"></i>
                                </button>
                            </div>
                            <div class="form-note">
                                <i class="fas fa-info-circle" aria-hidden="true"></i>
                                <span>Suporta YouTube, Vimeo e links diretos (http:// ou https://)</span>
                            </div>
                            <div class="url-status" id="urlStatus" style="display: none;">
                                <i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i>
                                <span>Verificando URL...</span>
                            </div>
                            <div class="validation-error" id="mediaUrlError">
                                <i class="fas fa-exclamation-circle" aria-hidden="true"></i>
                                <span>URL inv√°lida ou inacess√≠vel</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="mediaDescription">Descri√ß√£o</label>
                            <textarea id="mediaDescription" class="form-control" rows="3" 
                                      placeholder="Descri√ß√£o opcional da m√≠dia"
                                      aria-label="Descri√ß√£o da m√≠dia"></textarea>
                        </div>
                    </div>

                    <div id="localForm" style="display: none;">
                        <div class="form-group">
                            <label for="folderName">Nome da Pasta <span class="required" aria-label="obrigat√≥rio">*</span></label>
                            <input type="text" id="folderName" class="form-control" 
                                   placeholder="Ex: Minha Cole√ß√£o de M√∫sicas"
                                   aria-required="true" autocomplete="off">
                            <div class="validation-error" id="folderNameError">
                                <i class="fas fa-exclamation-circle" aria-hidden="true"></i>
                                <span>Nome da pasta √© obrigat√≥rio</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Selecione a Pasta <span class="required" aria-label="obrigat√≥rio">*</span></label>
                            <div class="folder-selection-area" id="folderDropZone">
                                <div class="folder-icon">
                                    <i class="fas fa-folder-open" aria-hidden="true"></i>
                                </div>
                                <p style="margin-bottom: 16px; color: var(--gray-color); font-size: 0.95rem;">
                                    Clique no bot√£o abaixo ou arraste uma pasta para c√°
                                </p>
                                <button type="button" class="btn" id="selectFolderBtn" 
                                        aria-label="Selecionar pasta do dispositivo">
                                    <i class="fas fa-folder-open" aria-hidden="true"></i>
                                    <span>Selecionar Pasta</span>
                                </button>
                                <div class="folder-status info" id="folderStatus" role="status" aria-live="polite">
                                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                                    <span>Pronto para selecionar uma pasta...</span>
                                </div>
                                <div class="file-list-preview" id="fileListPreview" style="display: none;"></div>
                            </div>
                            <div class="form-note">
                                <i class="fas fa-shield-alt" aria-hidden="true"></i>
                                <span>Por seguran√ßa, voc√™ precisar√° re-selecionar esta pasta ao reproduzir</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="folderDescription">Descri√ß√£o</label>
                            <textarea id="folderDescription" class="form-control" rows="3" 
                                      placeholder="Descri√ß√£o opcional do conte√∫do da pasta"
                                      aria-label="Descri√ß√£o da pasta"></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="mediaCategory">Categoria <span class="required" aria-label="obrigat√≥rio">*</span></label>
                            <select id="mediaCategory" class="form-control" required aria-required="true">
                                <option value="filmes">üé¨ Filmes</option>
                                <option value="series">üì∫ S√©ries</option>
                                <option value="musicas">üéµ M√∫sicas</option>
                                <option value="documentarios">üìñ Document√°rios</option>
                                <option value="podcasts">üéôÔ∏è Podcasts</option>
                                <option value="aulas">üéì Aulas</option>
                                <option value="outros">üìÅ Outros</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="playlistSelect">Playlist <span class="required" aria-label="obrigat√≥rio">*</span></label>
                            <select id="playlistSelect" class="form-control" required aria-required="true">
                                <option value="nova">+ Criar Nova Playlist</option>
                            </select>
                        </div>
                    </div>

                    <div id="newPlaylistInput" style="display: none;">
                        <div class="form-group">
                            <label for="newPlaylistName">Nome da Nova Playlist <span class="required" aria-label="obrigat√≥rio">*</span></label>
                            <input type="text" id="newPlaylistName" class="form-control" 
                                   placeholder="Digite o nome da nova playlist"
                                   aria-label="Nome da nova playlist" autocomplete="off">
                            <div class="validation-error" id="newPlaylistNameError">
                                <i class="fas fa-exclamation-circle" aria-hidden="true"></i>
                                <span>Nome da playlist √© obrigat√≥rio</span>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 12px; margin-top: 32px;">
                        <button type="submit" class="btn btn-block" id="saveItemBtn">
                            <i class="fas fa-save" aria-hidden="true"></i>
                            <span>Salvar Item</span>
                        </button>
                        <button type="button" class="btn btn-light btn-block" id="cancelItemBtn">
                            <i class="fas fa-times" aria-hidden="true"></i>
                            <span>Cancelar</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal" id="newPlaylistModal" role="dialog" aria-labelledby="newPlaylistModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="newPlaylistModalTitle">
                    <i class="fas fa-plus" aria-hidden="true"></i>
                    <span>Nova Playlist</span>
                </h3>
                <button class="close-modal" id="closeNewPlaylistModal" aria-label="Fechar modal">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="newPlaylistForm" novalidate>
                    <div class="form-group">
                        <label for="newPlaylistNameModal">Nome da Playlist <span class="required" aria-label="obrigat√≥rio">*</span></label>
                        <input type="text" id="newPlaylistNameModal" class="form-control" 
                               placeholder="Ex: Minha Cole√ß√£o 2024"
                               required aria-required="true" autocomplete="off">
                        <div class="validation-error" id="newPlaylistNameModalError">
                            <i class="fas fa-exclamation-circle" aria-hidden="true"></i>
                            <span>Nome da playlist √© obrigat√≥rio</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="newPlaylistDescription">Descri√ß√£o</label>
                        <textarea id="newPlaylistDescription" class="form-control" rows="3" 
                                  placeholder="Descri√ß√£o opcional da playlist"
                                  aria-label="Descri√ß√£o da playlist"></textarea>
                    </div>

                    <div style="display: flex; gap: 12px; margin-top: 32px;">
                        <button type="submit" class="btn btn-block" id="createPlaylistBtn">
                            <i class="fas fa-plus" aria-hidden="true"></i>
                            <span>Criar Playlist</span>
                        </button>
                        <button type="button" class="btn btn-light btn-block" id="cancelPlaylistBtn">
                            <i class="fas fa-times" aria-hidden="true"></i>
                            <span>Cancelar</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer" aria-live="polite" aria-atomic="true"></div>

    <div class="loader-overlay" id="loaderOverlay" role="dialog" aria-label="Carregando" aria-modal="true">
        <div class="loader" aria-hidden="true"></div>
        <div class="loader-text" id="loaderText">Carregando...</div>
        <div class="loader-subtext" id="loaderSubtext">Por favor, aguarde</div>
    </div>

    <script>
        // ============================================
        // CONFIGURA√á√ÉO E CONSTANTES
        // ============================================
        const CONFIG = {
            MAX_RECURSION_DEPTH: 5,
            MAX_FILES: 2000,
            SUPPORTED_AUDIO: ['.mp3', '.wav', '.flac', '.aac', '.ogg', '.m4a', '.wma', '.opus'],
            SUPPORTED_VIDEO: ['.mp4', '.mkv', '.avi', '.mov', '.webm', '.m4v', '.flv', '.wmv', '.ogv'],
            STORAGE_KEY: 'mediaPlaylists_v2'
        };

        // ============================================
        // ESTADO DA APLICA√á√ÉO
        // ============================================
        const state = {
            playlists: [],
            currentPlaylist: null,
            currentMediaIndex: 0,
            mediaFiles: [],
            isShuffle: false,
            isRepeat: false,
            shuffledIndices: [],
            folderHandle: null,
            sidebarOpen: window.innerWidth > 768,
            currentSort: 'name',
            searchTerm: '',
            isPlaying: false,
            volume: 100,
            lastVolume: 100
        };

        // ============================================
        // ELEMENTOS DOM - CACHE
        // ============================================
        const elements = {};
        
        function cacheElements() {
            const ids = [
                'toggleSidebar', 'sidebar', 'mainContent', 'playlistList', 'playlistSearch', 
                'totalPlaylists', 'mediaContainer', 'currentPlaylistTitle', 'totalItems', 
                'mediaListView', 'mediaListBody', 'mediaSearch', 'videoPlayer', 'audioPlayer', 
                'embedPlayer', 'prevBtn', 'playBtn', 'nextBtn', 'shuffleBtn', 'repeatBtn', 
                'playAllBtn', 'progressSection', 'progressBar', 'progressBarContainer', 
                'currentTime', 'duration', 'currentTrackInfo', 'currentTrackName', 
                'currentTrackMeta', 'addItemModal', 'newPlaylistModal', 'closeAddItemModal', 
                'closeNewPlaylistModal', 'addItemForm', 'newPlaylistForm', 'itemType', 
                'onlineForm', 'localForm', 'mediaTitle', 'mediaUrl', 'mediaDescription', 
                'folderName', 'folderDescription', 'selectFolderBtn', 'folderStatus', 
                'mediaCategory', 'playlistSelect', 'newPlaylistInput', 'newPlaylistName', 
                'saveItemBtn', 'cancelItemBtn', 'newPlaylistNameModal', 'newPlaylistDescription', 
                'createPlaylistBtn', 'cancelPlaylistBtn', 'newPlaylistBtn', 'addItemBtn', 
                'exportBtn', 'importBtn', 'importFile', 'toastContainer', 'loaderOverlay', 
                'loaderText', 'loaderSubtext', 'volumeSlider', 'volumeValue', 'volumeIcon',
                'validateUrlBtn', 'urlStatus', 'folderDropZone', 'fileListPreview', 
                'fabContainer', 'fabMenu', 'fabToggle', 'fabNewPlaylist', 'fabAddItem'
            ];
            
            ids.forEach(id => elements[id] = document.getElementById(id));
            elements.sortBtns = document.querySelectorAll('.sort-btn');
        }

        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================
        document.addEventListener('DOMContentLoaded', async () => {
            cacheElements();
            await initializeApp();
        });

        async function initializeApp() {
            showLoader('Iniciando aplica√ß√£o...');
            try {
                await loadPlaylists();
                setupEventListeners();
                setupKeyboardShortcuts();
                setupDragAndDrop();
                checkBrowserSupport();
                updatePlaylistStats();
                
                const savedVolume = localStorage.getItem('playerVolume');
                if (savedVolume !== null) {
                    state.volume = parseInt(savedVolume);
                    elements.volumeSlider.value = state.volume;
                    updateVolumeIcon(state.volume);
                }
                
                hideLoader();
                showToast('‚úÖ Arm√°rio de M√≠dias pronto!', 'success', 2000);
            } catch (error) {
                hideLoader();
                showToast('‚ùå Erro ao inicializar: ' + error.message, 'error');
            }
        }

        function checkBrowserSupport() {
            if (!window.showDirectoryPicker) {
                showToast('‚ö†Ô∏è Seu navegador n√£o suporta acesso a pastas locais. Use Chrome ou Edge.', 'warning', 8000);
            }
        }

        // ============================================
        // GERENCIAMENTO DE DADOS
        // ============================================
        async function loadPlaylists() {
            try {
                const saved = localStorage.getItem(CONFIG.STORAGE_KEY);
                if (saved) {
                    const data = JSON.parse(saved);
                    state.playlists = data.version === '2.0' ? data.playlists : (Array.isArray(data) ? data : []);
                }
                renderPlaylists();
                renderMediaItems();
            } catch (error) {
                state.playlists = [];
                showToast('‚ùå Erro ao carregar dados', 'error');
            }
        }

        function savePlaylists() {
            try {
                const data = { version: '2.0', exportDate: new Date().toISOString(), playlists: state.playlists };
                localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(data));
            } catch (error) {
                showToast('‚ùå Erro ao salvar dados', 'error');
            }
        }

        function exportData() {
            try {
                const data = { version: '2.0', exportDate: new Date().toISOString(), appName: 'Arm√°rio de M√≠dias', playlists: state.playlists };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `armario-midias-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showToast('‚úÖ Dados exportados!', 'success');
            } catch (error) {
                showToast('‚ùå Erro ao exportar', 'error');
            }
        }

        async function importData(file) {
            try {
                const text = await file.text();
                const data = JSON.parse(text);
                if (!data.playlists || !Array.isArray(data.playlists)) throw new Error('Formato inv√°lido');
                
                if (confirm(`Importar ${data.playlists.length} playlist(s)? Isso substituir√° os dados atuais.`)) {
                    state.playlists = data.playlists;
                    savePlaylists();
                    await loadPlaylists();
                    showToast('‚úÖ Importa√ß√£o conclu√≠da!', 'success');
                }
            } catch (error) {
                showToast('‚ùå Erro ao importar: ' + error.message, 'error');
            }
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        function setupEventListeners() {
            elements.toggleSidebar?.addEventListener('click', toggleSidebar);
            elements.fabToggle?.addEventListener('click', toggleFabMenu);
            elements.fabNewPlaylist?.addEventListener('click', () => { toggleFabMenu(); openNewPlaylistModal(); });
            elements.fabAddItem?.addEventListener('click', () => { toggleFabMenu(); openAddItemModal(); });
            elements.newPlaylistBtn?.addEventListener('click', openNewPlaylistModal);
            elements.addItemBtn?.addEventListener('click', openAddItemModal);
            elements.exportBtn?.addEventListener('click', exportData);
            elements.importBtn?.addEventListener('click', () => elements.importFile?.click());
            elements.importFile?.addEventListener('change', (e) => { if (e.target.files?.[0]) { importData(e.target.files[0]); e.target.value = ''; }});
            elements.itemType?.addEventListener('change', (e) => {
                elements.onlineForm.style.display = e.target.value === 'online' ? 'block' : 'none';
                elements.localForm.style.display = e.target.value === 'online' ? 'none' : 'block';
            });
            elements.playlistSelect?.addEventListener('change', (e) => { elements.newPlaylistInput.style.display = e.target.value === 'nova' ? 'block' : 'none'; });
            elements.selectFolderBtn?.addEventListener('click', selectFolder);
            elements.validateUrlBtn?.addEventListener('click', validateUrl);
            elements.mediaUrl?.addEventListener('blur', () => { if (elements.mediaUrl.value.trim()) validateUrl(); });
            elements.addItemForm?.addEventListener('submit', handleSaveItem);
            elements.newPlaylistForm?.addEventListener('submit', handleCreatePlaylist);
            elements.cancelItemBtn?.addEventListener('click', () => closeModal(elements.addItemModal));
            elements.cancelPlaylistBtn?.addEventListener('click', () => closeModal(elements.newPlaylistModal));
            elements.closeAddItemModal?.addEventListener('click', () => closeModal(elements.addItemModal));
            elements.closeNewPlaylistModal?.addEventListener('click', () => closeModal(elements.newPlaylistModal));
            [elements.addItemModal, elements.newPlaylistModal].forEach(modal => {
                modal?.addEventListener('click', (e) => { if (e.target === modal) closeModal(modal); });
            });
            elements.playlistSearch?.addEventListener('input', debounce(filterPlaylists, 300));
            elements.mediaSearch?.addEventListener('input', debounce((e) => { state.searchTerm = e.target.value.toLowerCase(); renderMediaItems(); }, 300));
            elements.sortBtns?.forEach(btn => btn.addEventListener('click', () => handleSort(btn)));
            elements.playBtn?.addEventListener('click', togglePlay);
            elements.prevBtn?.addEventListener('click', playPrevious);
            elements.nextBtn?.addEventListener('click', playNext);
            elements.shuffleBtn?.addEventListener('click', toggleShuffle);
            elements.repeatBtn?.addEventListener('click', toggleRepeat);
            elements.playAllBtn?.addEventListener('click', playAll);
            elements.progressBarContainer?.addEventListener('click', handleSeek);
            elements.progressBarContainer?.addEventListener('keydown', handleProgressKeydown);
            elements.volumeSlider?.addEventListener('input', handleVolumeChange);
            elements.volumeIcon?.addEventListener('click', toggleMute);
            setupMediaPlayerEvents();
            elements.playlistList?.addEventListener('click', handlePlaylistListClick);
            elements.mediaListBody?.addEventListener('click', handleMediaListClick);
            window.addEventListener('resize', debounce(handleResize, 250));
            window.addEventListener('beforeunload', () => localStorage.setItem('playerVolume', state.volume));
        }

        function setupMediaPlayerEvents() {
            ['timeupdate', 'ended', 'play', 'pause', 'loadedmetadata', 'error', 'waiting', 'playing', 'canplay'].forEach(event => {
                elements.videoPlayer?.addEventListener(event, handleVideoEvent);
                elements.audioPlayer?.addEventListener(event, handleAudioEvent);
            });
            elements.videoPlayer?.addEventListener('volumechange', syncVolume);
            elements.audioPlayer?.addEventListener('volumechange', syncVolume);
        }

        function handleVideoEvent(e) {
            if (e.type === 'timeupdate') updateProgress();
            else if (e.type === 'ended') handleMediaEnded();
            else if (e.type === 'play') updatePlayButton(true);
            else if (e.type === 'pause') updatePlayButton(false);
            else if (e.type === 'loadedmetadata') updateDuration();
            else if (e.type === 'error') handleMediaError(e);
            else if (e.type === 'waiting') showLoader('Carregando v√≠deo...');
            else if (['playing', 'canplay'].includes(e.type)) hideLoader();
        }

        function handleAudioEvent(e) {
            if (e.type === 'timeupdate') updateProgress();
            else if (e.type === 'ended') handleMediaEnded();
            else if (e.type === 'play') updatePlayButton(true);
            else if (e.type === 'pause') updatePlayButton(false);
            else if (e.type === 'loadedmetadata') updateDuration();
            else if (e.type === 'error') handleMediaError(e);
            else if (e.type === 'waiting') showLoader('Carregando √°udio...');
            else if (['playing', 'canplay'].includes(e.type)) hideLoader();
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
                    if (e.key === 'Escape') e.target.blur();
                    return;
                }
                switch(e.key) {
                    case 'Escape': closeAllModals(); break;
                    case ' ':
                        if (state.mediaFiles.length > 0 || elements.videoPlayer?.src || elements.audioPlayer?.src) {
                            e.preventDefault();
                            togglePlay();
                        }
                        break;
                    case 'ArrowRight': if (e.altKey) { e.preventDefault(); playNext(); } break;
                    case 'ArrowLeft': if (e.altKey) { e.preventDefault(); playPrevious(); } break;
                    case 's': case 'S': toggleShuffle(); break;
                    case 'r': case 'R': toggleRepeat(); break;
                    case 'm': case 'M': toggleMute(); break;
                    case 'n': case 'N': if (e.ctrlKey || e.metaKey) { e.preventDefault(); openAddItemModal(); } break;
                }
            });
        }

        function setupDragAndDrop() {
            if (!elements.folderDropZone) return;
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                elements.folderDropZone.addEventListener(eventName, (e) => { e.preventDefault(); e.stopPropagation(); }, false);
            });
            ['dragenter', 'dragover'].forEach(eventName => {
                elements.folderDropZone.addEventListener(eventName, () => elements.folderDropZone.classList.add('dragover'), false);
            });
            ['dragleave', 'drop'].forEach(eventName => {
                elements.folderDropZone.addEventListener(eventName, () => elements.folderDropZone.classList.remove('dragover'), false);
            });
        }

        // ============================================
        // HANDLERS DE UI
        // ============================================
        function toggleSidebar() {
            state.sidebarOpen = !state.sidebarOpen;
            elements.sidebar?.classList.toggle('hidden', !state.sidebarOpen);
            elements.sidebar?.classList.toggle('show', state.sidebarOpen);
            if (elements.toggleSidebar) {
                elements.toggleSidebar.setAttribute('aria-expanded', state.sidebarOpen);
                const icon = elements.toggleSidebar.querySelector('i');
                if (icon) icon.className = state.sidebarOpen ? 'fas fa-bars' : 'fas fa-times';
            }
        }

        function toggleFabMenu() {
            const isOpen = elements.fabMenu?.classList.contains('show');
            elements.fabMenu?.classList.toggle('show', !isOpen);
            elements.fabToggle?.setAttribute('aria-expanded', !isOpen);
            const icon = elements.fabToggle?.querySelector('i');
            if (icon) icon.style.transform = isOpen ? 'rotate(0deg)' : 'rotate(45deg)';
        }

        function handleSort(btn) {
            elements.sortBtns?.forEach(b => { b.classList.remove('active'); b.setAttribute('aria-checked', 'false'); });
            btn.classList.add('active');
            btn.setAttribute('aria-checked', 'true');
            state.currentSort = btn.dataset.sort;
            renderMediaItems();
        }

        function handleResize() {
            if (window.innerWidth > 768) {
                elements.sidebar?.classList.remove('hidden');
                state.sidebarOpen = true;
            }
        }

        // ============================================
        // VALIDA√á√ÉO DE URL
        // ============================================
        async function validateUrl() {
            const url = elements.mediaUrl?.value.trim();
            if (!url) return false;
            const statusEl = elements.urlStatus;
            const errorEl = document.getElementById('mediaUrlError');
            errorEl?.classList.remove('show');
            statusEl.style.display = 'flex';
            statusEl.className = 'url-status checking';
            statusEl.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i><span>Verificando...</span>';
            try {
                new URL(url);
                if (getYouTubeVideoId(url) || getVimeoVideoId(url)) {
                    statusEl.className = 'url-status valid';
                    statusEl.innerHTML = '<i class="fas fa-check-circle"></i><span>V√≠deo externo detectado</span>';
                    setTimeout(() => statusEl.style.display = 'none', 3000);
                    return true;
                }
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 5000);
                    await fetch(url, { method: 'HEAD', mode: 'no-cors', signal: controller.signal });
                    clearTimeout(timeoutId);
                } catch (e) {}
                statusEl.className = 'url-status valid';
                statusEl.innerHTML = '<i class="fas fa-check-circle"></i><span>URL v√°lida</span>';
                setTimeout(() => statusEl.style.display = 'none', 3000);
                return true;
            } catch (error) {
                statusEl.className = 'url-status invalid';
                statusEl.innerHTML = '<i class="fas fa-times-circle"></i><span>URL inv√°lida</span>';
                errorEl?.classList.add('show');
                return false;
            }
        }

        // ============================================
        // PASTAS LOCAIS
        // ============================================
        async function selectFolder() {
            if (!window.showDirectoryPicker) {
                showFolderError('Use Chrome ou Edge para acesso a pastas');
                return;
            }
            updateFolderStatus('info', 'Abrindo seletor...');
            elements.selectFolderBtn.disabled = true;
            try {
                const handle = await window.showDirectoryPicker({ mode: 'read' });
                await processFolder(handle);
            } catch (error) {
                if (error.name !== 'AbortError') showFolderError('Erro: ' + error.message);
            } finally {
                elements.selectFolderBtn.disabled = false;
            }
        }

        async function processFolder(handle) {
            state.folderHandle = handle;
            updateFolderStatus('info', 'Escaneando...');
            showLoader('Escaneando arquivos...', 'Isso pode levar um instante');
            try {
                const files = await scanDirectory(handle);
                const mediaFiles = files.filter(file => isMediaFile(file.name));
                hideLoader();
                if (mediaFiles.length === 0) {
                    showFolderError('Nenhum arquivo de m√≠dia encontrado');
                    state.folderHandle = null;
                    return;
                }
                updateFolderStatus('success', `${mediaFiles.length} arquivo(s) encontrado(s)`);
                showFilePreview(mediaFiles);
                if (elements.folderName && !elements.folderName.value.trim()) elements.folderName.value = handle.name;
            } catch (error) {
                hideLoader();
                showFolderError('Erro ao escanear: ' + error.message);
                state.folderHandle = null;
            }
        }

        async function scanDirectory(directoryHandle, path = '', depth = 0) {
            if (depth > CONFIG.MAX_RECURSION_DEPTH) return [];
            const files = [];
            let entryCount = 0;
            for await (const entry of directoryHandle.values()) {
                if (++entryCount > CONFIG.MAX_FILES) {
                    showToast(`‚ö†Ô∏è Limite de ${CONFIG.MAX_FILES} arquivos atingido`, 'warning');
                    break;
                }
                const entryPath = path ? `${path}/${entry.name}` : entry.name;
                if (entry.kind === 'file') {
                    try {
                        const file = await entry.getFile();
                        files.push({ name: entry.name, path: entryPath, type: file.type, size: file.size, handle: entry, lastModified: file.lastModified });
                    } catch (err) {}
                } else if (entry.kind === 'directory') {
                    try {
                        const subFiles = await scanDirectory(entry, entryPath, depth + 1);
                        files.push(...subFiles);
                    } catch (err) {}
                }
            }
            return files;
        }

        function showFilePreview(files) {
            const previewEl = elements.fileListPreview;
            if (!previewEl) return;
            const audioCount = files.filter(f => isAudioFile(f.name)).length;
            const videoCount = files.filter(f => isVideoFile(f.name)).length;
            let html = `<div style="margin-bottom: 12px; font-weight: 600;"><i class="fas fa-music" style="color: var(--secondary-color);"></i> ${audioCount} <i class="fas fa-video" style="color: var(--danger-color); margin-left: 12px;"></i> ${videoCount}</div>`;
            files.slice(0, 10).forEach(file => {
                const icon = isAudioFile(file.name) ? 'fa-music' : 'fa-video';
                const color = isAudioFile(file.name) ? 'var(--secondary-color)' : 'var(--danger-color)';
                html += `<div class="file-list-item"><i class="fas ${icon}" style="color: ${color};"></i><span>${escapeHtml(file.name)}</span><span style="margin-left: auto; color: var(--gray-color); font-size: 0.8rem;">${formatFileSize(file.size)}</span></div>`;
            });
            if (files.length > 10) html += `<div class="file-list-item" style="color: var(--gray-color); font-style: italic;"><i class="fas fa-ellipsis-h"></i><span>e mais ${files.length - 10}...</span></div>`;
            previewEl.innerHTML = html;
            previewEl.style.display = 'block';
        }

        function updateFolderStatus(type, message) {
            if (!elements.folderStatus) return;
            const icons = { info: 'fa-info-circle', success: 'fa-check-circle', error: 'fa-exclamation-triangle' };
            elements.folderStatus.className = `folder-status ${type}`;
            elements.folderStatus.innerHTML = `<i class="fas ${icons[type]}"></i><span>${message}</span>`;
        }

        function showFolderError(message) {
            updateFolderStatus('error', message);
            showToast('‚ùå ' + message, 'error');
        }

        // ============================================
        // SALVAR ITENS
        // ============================================
        async function handleSaveItem(e) {
            e.preventDefault();
            if (!validateForm(elements.itemType.value)) return;
            showLoader('Salvando...');
            try {
                if (elements.itemType.value === 'online') await saveOnlineItem();
                else await saveLocalItem();
                savePlaylists();
                await loadPlaylists();
                closeModal(elements.addItemModal);
                showToast('‚úÖ Item adicionado!', 'success');
            } catch (error) {
                showToast('‚ùå Erro: ' + error.message, 'error');
            } finally {
                hideLoader();
            }
        }

        function validateForm(itemType) {
            let isValid = true;
            document.querySelectorAll('.validation-error').forEach(el => el.classList.remove('show'));
            if (itemType === 'online') {
                if (!elements.mediaTitle?.value.trim()) { document.getElementById('mediaTitleError')?.classList.add('show'); isValid = false; }
                if (!elements.mediaUrl?.value.trim() || !isValidUrl(elements.mediaUrl.value.trim())) { document.getElementById('mediaUrlError')?.classList.add('show'); isValid = false; }
            } else {
                if (!elements.folderName?.value.trim()) { document.getElementById('folderNameError')?.classList.add('show'); isValid = false; }
                if (!state.folderHandle) { showFolderError('Selecione uma pasta'); isValid = false; }
            }
            if (elements.playlistSelect?.value === 'nova' && !elements.newPlaylistName?.value.trim()) {
                document.getElementById('newPlaylistNameError')?.classList.add('show');
                isValid = false;
            }
            return isValid;
        }

        async function saveOnlineItem() {
            const playlist = getOrCreatePlaylist();
            playlist.items.push({
                id: generateId(), type: 'online', title: elements.mediaTitle.value.trim(),
                url: elements.mediaUrl.value.trim(), description: elements.mediaDescription?.value?.trim() || '',
                category: elements.mediaCategory?.value || 'outros', createdAt: new Date().toISOString()
            });
        }

        async function saveLocalItem() {
            if (!state.folderHandle) throw new Error('Nenhuma pasta selecionada');
            const files = await scanDirectory(state.folderHandle);
            const mediaFiles = files.filter(file => isMediaFile(file.name));
            if (mediaFiles.length === 0) throw new Error('Nenhum arquivo de m√≠dia');
            const audioCount = mediaFiles.filter(f => isAudioFile(f.name)).length;
            const videoCount = mediaFiles.filter(f => isVideoFile(f.name)).length;
            const playlist = getOrCreatePlaylist();
            playlist.items.push({
                id: generateId(), type: 'local', folderName: elements.folderName.value.trim(),
                description: elements.folderDescription?.value?.trim() || '',
                category: elements.mediaCategory?.value || 'outros', fileCount: mediaFiles.length,
                audioCount, videoCount, createdAt: new Date().toISOString()
            });
            state.folderHandle = null;
        }

        function getOrCreatePlaylist() {
            const playlistId = elements.playlistSelect?.value;
            if (playlistId === 'nova') {
                const newPlaylist = { id: generateId(), name: elements.newPlaylistName.value.trim(), description: '', items: [], createdAt: new Date().toISOString() };
                state.playlists.push(newPlaylist);
                return newPlaylist;
            }
            return state.playlists.find(p => p.id === playlistId);
        }

        function handleCreatePlaylist(e) {
            e.preventDefault();
            const name = elements.newPlaylistNameModal?.value.trim();
            if (!name) { document.getElementById('newPlaylistNameModalError')?.classList.add('show'); return; }
            state.playlists.push({ id: generateId(), name, description: elements.newPlaylistDescription?.value?.trim() || '', items: [], createdAt: new Date().toISOString() });
            savePlaylists();
            renderPlaylists();
            closeModal(elements.newPlaylistModal);
            showToast('‚úÖ Playlist criada!', 'success');
        }

        // ============================================
        // PLAYLISTS
        // ============================================
        function renderPlaylists() {
            if (!elements.playlistList) return;
            elements.playlistList.innerHTML = '';
            if (state.playlists.length === 0) {
                elements.playlistList.innerHTML = `<li style="padding: 30px 20px; text-align: center; color: var(--gray-color);"><i class="fas fa-inbox" style="font-size: 2.5rem; margin-bottom: 16px; display: block; opacity: 0.5;"></i><div style="font-weight: 600;">Nenhuma playlist</div><div style="font-size: 0.9rem;">Crie sua primeira playlist!</div></li>`;
                if (elements.totalPlaylists) elements.totalPlaylists.textContent = '0';
                return;
            }
            state.playlists.forEach(playlist => {
                const li = document.createElement('li');
                li.className = 'playlist-item' + (state.currentPlaylist?.id === playlist.id ? ' active' : '');
                li.dataset.id = playlist.id;
                li.setAttribute('role', 'listitem');
                li.setAttribute('tabindex', '0');
                li.setAttribute('aria-label', `${playlist.name}, ${playlist.items.length} itens`);
                li.innerHTML = `<div class="playlist-info"><div class="playlist-name">${escapeHtml(playlist.name)}</div><div class="playlist-stats"><i class="fas fa-film"></i><span>${playlist.items.length} item(s)</span></div></div><div class="playlist-actions"><button class="btn-action delete-playlist" title="Excluir" aria-label="Excluir ${escapeHtml(playlist.name)}"><i class="fas fa-trash"></i></button></div>`;
                li.addEventListener('click', (e) => {
                    if (e.target.closest('.delete-playlist')) { e.stopPropagation(); deletePlaylist(playlist.id); }
                    else selectPlaylist(playlist.id);
                });
                li.addEventListener('keypress', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); selectPlaylist(playlist.id); }});
                elements.playlistList.appendChild(li);
            });
            if (elements.totalPlaylists) elements.totalPlaylists.textContent = state.playlists.length;
        }

        function deletePlaylist(id) {
            const playlist = state.playlists.find(p => p.id === id);
            if (!playlist || !confirm(`Excluir "${playlist.name}" e seus ${playlist.items.length} itens?`)) return;
            state.playlists = state.playlists.filter(p => p.id !== id);
            if (state.currentPlaylist?.id === id) { state.currentPlaylist = null; elements.mediaListView?.classList.remove('active'); }
            savePlaylists();
            renderPlaylists();
            renderMediaItems();
            showToast('‚úÖ Playlist exclu√≠da', 'success');
        }

        function selectPlaylist(id) {
            state.currentPlaylist = state.playlists.find(p => p.id === id);
            renderPlaylists();
            renderMediaItems();
            elements.mediaListView?.classList.add('active');
            if (window.innerWidth <= 768) elements.mainContent?.scrollIntoView({ behavior: 'smooth' });
        }

        function filterPlaylists() {
            const term = elements.playlistSearch?.value.toLowerCase() || '';
            document.querySelectorAll('.playlist-item').forEach(item => {
                item.style.display = item.querySelector('.playlist-name')?.textContent.toLowerCase().includes(term) ? 'flex' : 'none';
            });
        }

        // ============================================
        // RENDERIZA√á√ÉO DE M√çDIAS
        // ============================================
        function renderMediaItems() {
            if (!elements.mediaContainer) return;
            let items = [];
            let playlistName = 'Todas as M√≠dias';
            let icon = 'fa-film';
            if (state.currentPlaylist) {
                items = [...state.currentPlaylist.items];
                playlistName = state.currentPlaylist.name;
                const nameLower = playlistName.toLowerCase();
                if (nameLower.includes('m√∫sica') || nameLower.includes('musica') || nameLower.includes('music')) icon = 'fa-music';
                else if (nameLower.includes('filme') || nameLower.includes('movie')) icon = 'fa-film';
                else if (nameLower.includes('s√©rie') || nameLower.includes('serie') || nameLower.includes('tv')) icon = 'fa-tv';
                else if (nameLower.includes('podcast')) icon = 'fa-podcast';
                else if (nameLower.includes('aula') || nameLower.includes('curso')) icon = 'fa-graduation-cap';
            } else {
                state.playlists.forEach(p => items.push(...p.items));
                elements.mediaListView?.classList.remove('active');
            }
            if (state.searchTerm) items = items.filter(item => [item.title || item.folderName || '', item.description || '', item.category || ''].join(' ').toLowerCase().includes(state.searchTerm));
            items.sort((a, b) => {
                if (state.currentSort === 'name') return (a.title || a.folderName || '').toLowerCase().localeCompare((b.title || b.folderName || '').toLowerCase(), undefined, { numeric: true });
                else if (state.currentSort === 'date') return new Date(b.createdAt || 0) - new Date(a.createdAt || 0);
                else if (state.currentSort === 'type') return (a.type || '').localeCompare(b.type || '');
                return 0;
            });
            if (elements.currentPlaylistTitle) elements.currentPlaylistTitle.innerHTML = `<i class="fas ${icon}"></i><span>${escapeHtml(playlistName)}</span>`;
            if (elements.totalItems) elements.totalItems.textContent = `${items.length} item(s)`;
            if (items.length === 0) {
                elements.mediaContainer.innerHTML = `<div class="empty-state"><div class="empty-icon">${state.searchTerm ? 'üîç' : 'üìÅ'}</div><div class="empty-text">Nenhuma m√≠dia</div><div class="empty-subtext">${state.searchTerm ? 'Nenhum resultado' : (state.currentPlaylist ? 'Playlist vazia' : 'Adicione itens')}</div></div>`;
                return;
            }
            const grid = document.createElement('div');
            grid.className = 'media-grid';
            grid.setAttribute('role', 'list');
            items.forEach(item => grid.appendChild(createMediaCard(item)));
            elements.mediaContainer.innerHTML = '';
            elements.mediaContainer.appendChild(grid);
            if (state.currentPlaylist) renderMediaList(items);
        }

        function createMediaCard(item) {
            const card = document.createElement('div');
            card.className = 'media-card';
            card.setAttribute('role', 'listitem');
            card.setAttribute('tabindex', '0');
            const isOnline = item.type === 'online';
            const title = item.title || item.folderName || 'Sem t√≠tulo';
            let thumbnailContent = isOnline ? 'üåê' : 'üìÅ';
            if (isOnline && item.url) {
                const youtubeId = getYouTubeVideoId(item.url);
                if (youtubeId) thumbnailContent = `<img src="https://img.youtube.com/vi/${youtubeId}/mqdefault.jpg" alt="" loading="lazy" onerror="this.parentElement.innerHTML='‚ñ∂Ô∏è'">`;
            }
            const badges = [];
            if (isOnline) badges.push('<span class="badge badge-online"><i class="fas fa-globe"></i> Online</span>');
            else {
                badges.push('<span class="badge badge-local"><i class="fas fa-folder"></i> Local</span>');
                if (item.videoCount > 0) badges.push(`<span class="badge badge-video"><i class="fas fa-video"></i> ${item.videoCount}</span>`);
                if (item.audioCount > 0) badges.push(`<span class="badge badge-audio"><i class="fas fa-music"></i> ${item.audioCount}</span>`);
            }
            card.innerHTML = `<div class="media-thumbnail">${thumbnailContent}<div class="play-overlay"><i class="fas fa-play"></i></div></div><div class="media-info"><div class="media-title">${escapeHtml(title)}</div><div class="media-description">${escapeHtml(item.description) || (isOnline ? 'Link online' : `${item.fileCount} arquivo(s)`)}</div><div class="media-footer"><div class="media-meta">${badges.join('')}</div>${isOnline ? `<div class="media-actions"><button class="btn-share" title="Compartilhar" aria-label="Compartilhar ${escapeHtml(title)}"><i class="fab fa-whatsapp"></i></button></div>` : ''}</div></div>`;
            card.addEventListener('click', () => isOnline ? playOnlineMedia(item) : playLocalFolder(item));
            card.addEventListener('keypress', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); card.click(); }});
            if (isOnline) card.querySelector('.btn-share')?.addEventListener('click', (e) => { e.stopPropagation(); shareMedia(item); });
            return card;
        }

        function renderMediaList(items) {
            if (!elements.mediaListBody) return;
            elements.mediaListBody.innerHTML = '';
            items.forEach((item, displayIndex) => {
                const originalIndex = state.currentPlaylist.items.indexOf(item);
                const isOnline = item.type === 'online';
                const isActive = state.currentMediaIndex === originalIndex && state.mediaFiles.length > 0;
                const tr = document.createElement('tr');
                tr.className = isActive ? 'active' : '';
                tr.dataset.index = originalIndex;
                const typeBadge = isOnline ? '<span class="badge badge-online">Online</span>' : `<span class="badge badge-local">Local</span>${item.videoCount > 0 ? `<span class="badge badge-video">${item.videoCount} v√≠deo(s)</span>` : ''}${item.audioCount > 0 ? `<span class="badge badge-audio">${item.audioCount} √°udio(s)</span>` : ''}`;
                tr.innerHTML = `<td>${displayIndex + 1}</td><td><strong>${escapeHtml(item.title || item.folderName)}</strong>${item.description ? `<div style="font-size: 0.85rem; color: var(--gray-color); margin-top: 4px;">${escapeHtml(item.description)}</div>` : ''}</td><td>${typeBadge}</td><td class="table-actions">${isOnline ? `<button class="btn-action share-btn" title="Compartilhar"><i class="fab fa-whatsapp" style="color: #25D366;"></i></button>` : ''}<button class="btn-action play-btn" title="Reproduzir"><i class="fas fa-play" style="color: var(--primary-color);"></i></button></td>`;
                elements.mediaListBody.appendChild(tr);
            });
        }

        // ============================================
        // REPRODU√á√ÉO
        // ============================================
        function playOnlineMedia(item) {
            hidePlayers();
            updateTrackInfo(item.title || 'M√≠dia Online', item.description || 'Link externo');
            const youtubeId = getYouTubeVideoId(item.url);
            const vimeoId = getVimeoVideoId(item.url);
            if (youtubeId) {
                elements.embedPlayer.src = `https://www.youtube.com/embed/${youtubeId}?autoplay=1&rel=0`;
                elements.embedPlayer.style.display = 'block';
                elements.progressSection?.classList.remove('active');
                disablePlayerControls();
                showToast('‚ñ∂Ô∏è YouTube', 'info');
            } else if (vimeoId) {
                elements.embedPlayer.src = `https://player.vimeo.com/video/${vimeoId}?autoplay=1`;
                elements.embedPlayer.style.display = 'block';
                elements.progressSection?.classList.remove('active');
                disablePlayerControls();
                showToast('‚ñ∂Ô∏è Vimeo', 'info');
            } else {
                if (isVideoUrl(item.url)) {
                    elements.videoPlayer.src = item.url;
                    elements.videoPlayer.style.display = 'block';
                    elements.videoPlayer.play().catch(() => window.open(item.url, '_blank'));
                    elements.progressSection?.classList.add('active');
                } else if (isAudioUrl(item.url)) {
                    elements.audioPlayer.src = item.url;
                    elements.audioPlayer.style.display = 'block';
                    elements.audioPlayer.play().catch(() => window.open(item.url, '_blank'));
                    elements.progressSection?.classList.add('active');
                } else {
                    window.open(item.url, '_blank');
                    return;
                }
                enablePlayerControls();
            }
            scrollToPlayer();
        }

        async function playLocalFolder(item) {
            if (!window.showDirectoryPicker) { showToast('‚ùå Use Chrome/Edge', 'error', 5000); return; }
            showLoader('Selecione a pasta', 'Re-solicitando permiss√£o...');
            try {
                const handle = await window.showDirectoryPicker({ mode: 'read' });
                updateLoaderText('Escaneando...');
                const files = await scanDirectory(handle);
                const mediaFiles = files.filter(file => isMediaFile(file.name));
                hideLoader();
                if (mediaFiles.length === 0) { showToast('‚ö†Ô∏è Nenhum arquivo', 'warning'); return; }
                mediaFiles.sort((a, b) => a.name.localeCompare(b.name, undefined, { numeric: true }));
                state.mediaFiles = mediaFiles;
                state.currentMediaIndex = 0;
                state.isShuffle = false;
                state.shuffledIndices = [];
                renderMediaList(state.currentPlaylist.items);
                await playCurrentMedia();
                showToast(`‚úÖ ${mediaFiles.length} arquivo(s)`, 'success');
            } catch (error) {
                hideLoader();
                if (error.name !== 'AbortError') showToast('‚ùå Erro: ' + error.message, 'error');
            }
        }

        async function playCurrentMedia() {
            if (state.mediaFiles.length === 0) return;
            const file = state.mediaFiles[state.currentMediaIndex];
            if (!file?.handle) return;
            hidePlayers();
            try {
                const fileObj = await file.handle.getFile();
                const objectUrl = URL.createObjectURL(fileObj);
                updateTrackInfo(file.name, `${formatFileSize(file.size)} ‚Ä¢ ${state.currentMediaIndex + 1}/${state.mediaFiles.length}`);
                if (isVideoFile(file.name)) {
                    elements.videoPlayer.src = objectUrl;
                    elements.videoPlayer.style.display = 'block';
                    await elements.videoPlayer.play();
                } else {
                    elements.audioPlayer.src = objectUrl;
                    elements.audioPlayer.style.display = 'block';
                    await elements.audioPlayer.play();
                }
                document.querySelectorAll('#mediaListBody tr').forEach((row, idx) => row.classList.toggle('active', idx === state.currentMediaIndex));
                enablePlayerControls();
                elements.progressSection?.classList.add('active');
                scrollToPlayer();
            } catch (error) {
                showToast('‚ùå Erro ao carregar', 'error');
                if (state.currentMediaIndex < state.mediaFiles.length - 1) { state.currentMediaIndex++; await playCurrentMedia(); }
            }
        }

        function togglePlay() {
            const video = elements.videoPlayer;
            const audio = elements.audioPlayer;
            if (video?.style.display !== 'none' && video?.src) video.paused ? video.play() : video.pause();
            else if (audio?.style.display !== 'none' && audio?.src) audio.paused ? audio.play() : audio.pause();
        }

        function playNext() {
            if (state.mediaFiles.length === 0) return;
            if (state.isShuffle) {
                if (state.shuffledIndices.length === 0) state.shuffledIndices = [...Array(state.mediaFiles.length).keys()].filter(i => i !== state.currentMediaIndex).sort(() => Math.random() - 0.5);
                state.currentMediaIndex = state.shuffledIndices.shift() || 0;
            } else {
                state.currentMediaIndex++;
                if (state.currentMediaIndex >= state.mediaFiles.length) { state.currentMediaIndex = 0; if (!state.isRepeat) showToast('üîÑ Fim', 'info'); }
            }
            playCurrentMedia();
            updatePlayerButtons();
        }

        function playPrevious() {
            if (state.mediaFiles.length === 0) return;
            if (state.isShuffle) state.currentMediaIndex = Math.floor(Math.random() * state.mediaFiles.length);
            else {
                state.currentMediaIndex--;
                if (state.currentMediaIndex < 0) state.currentMediaIndex = state.mediaFiles.length - 1;
            }
            playCurrentMedia();
            updatePlayerButtons();
        }

        function toggleShuffle() {
            state.isShuffle = !state.isShuffle;
            state.shuffledIndices = [];
            elements.shuffleBtn?.classList.toggle('shuffle-active', state.isShuffle);
            elements.shuffleBtn?.setAttribute('aria-pressed', state.isShuffle);
            showToast(state.isShuffle ? 'üîÄ Aleat√≥rio' : '‚ñ∂Ô∏è Sequencial', 'info');
            updatePlayerButtons();
        }

        function toggleRepeat() {
            state.isRepeat = !state.isRepeat;
            elements.repeatBtn?.classList.toggle('shuffle-active', state.isRepeat);
            elements.repeatBtn?.setAttribute('aria-pressed', state.isRepeat);
            const icon = elements.repeatBtn?.querySelector('i');
            if (icon) icon.className = state.isRepeat ? 'fas fa-redo-alt' : 'fas fa-redo';
            showToast(state.isRepeat ? 'üîÅ Repetir' : '‚ñ∂Ô∏è N√£o repetir', 'info');
        }

        function playAll() {
            if (state.mediaFiles.length === 0) { showToast('‚ö†Ô∏è Selecione pasta', 'warning'); return; }
            state.currentMediaIndex = 0;
            state.isShuffle = false;
            state.shuffledIndices = [];
            elements.shuffleBtn?.classList.remove('shuffle-active');
            playCurrentMedia();
            updatePlayerButtons();
        }

        function handleMediaEnded() {
            if (state.isRepeat) {
                const video = elements.videoPlayer;
                const audio = elements.audioPlayer;
                if (video?.style.display !== 'none') { video.currentTime = 0; video.play(); }
                else if (audio?.style.display !== 'none') { audio.currentTime = 0; audio.play(); }
            } else playNext();
        }

        // ============================================
        // PROGRESSO E VOLUME
        // ============================================
        function updateProgress() {
            const video = elements.videoPlayer;
            const audio = elements.audioPlayer;
            let current = 0, total = 0;
            if (video?.style.display !== 'none' && video.duration) { current = video.currentTime; total = video.duration; }
            else if (audio?.style.display !== 'none' && audio.duration) { current = audio.currentTime; total = audio.duration; }
            else return;
            if (!isFinite(total)) return;
            const percent = (current / total) * 100;
            if (elements.progressBar) elements.progressBar.style.width = `${percent}%`;
            if (elements.progressBarContainer) elements.progressBarContainer.setAttribute('aria-valuenow', Math.round(percent));
            if (elements.currentTime) elements.currentTime.textContent = formatTime(current);
            if (elements.duration) elements.duration.textContent = formatTime(total);
        }

        function updateDuration() {
            const video = elements.videoPlayer;
            const audio = elements.audioPlayer;
            let duration = 0;
            if (video?.style.display !== 'none' && video.duration) duration = video.duration;
            else if (audio?.style.display !== 'none' && audio.duration) duration = audio.duration;
            if (elements.duration && isFinite(duration)) elements.duration.textContent = formatTime(duration);
        }

        function handleSeek(e) {
            const container = elements.progressBarContainer;
            const video = elements.videoPlayer;
            const audio = elements.audioPlayer;
            if (!container || (!video?.duration && !audio?.duration)) return;
            const rect = container.getBoundingClientRect();
            const percent = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
            const duration = video?.style.display !== 'none' ? video.duration : audio.duration;
            const newTime = duration * percent;
            if (video?.style.display !== 'none') video.currentTime = newTime;
            else audio.currentTime = newTime;
        }

        function handleProgressKeydown(e) {
            const video = elements.videoPlayer;
            const audio = elements.audioPlayer;
            const player = video?.style.display !== 'none' ? video : audio;
            if (!player?.duration) return;
            const step = player.duration * 0.05;
            switch(e.key) {
                case 'ArrowRight': e.preventDefault(); player.currentTime = Math.min(player.duration, player.currentTime + step); break;
                case 'ArrowLeft': e.preventDefault(); player.currentTime = Math.max(0, player.currentTime - step); break;
                case 'Home': e.preventDefault(); player.currentTime = 0; break;
                case 'End': e.preventDefault(); player.currentTime = player.duration; break;
            }
        }

        function handleVolumeChange(e) {
            const value = parseInt(e.target.value);
            state.volume = value;
            if (elements.videoPlayer) elements.videoPlayer.volume = value / 100;
            if (elements.audioPlayer) elements.audioPlayer.volume = value / 100;
            localStorage.setItem('playerVolume', value);
            updateVolumeIcon(value);
            if (elements.volumeValue) elements.volumeValue.textContent = `${value}%`;
        }

        function toggleMute() {
            const video = elements.videoPlayer;
            const audio = elements.audioPlayer;
            if (state.volume > 0) { state.lastVolume = state.volume; state.volume = 0; }
            else state.volume = state.lastVolume || 100;
            if (elements.volumeSlider) elements.volumeSlider.value = state.volume;
            if (video) video.volume = state.volume / 100;
            if (audio) audio.volume = state.volume / 100;
            updateVolumeIcon(state.volume);
            if (elements.volumeValue) elements.volumeValue.textContent = `${state.volume}%`;
        }

        function updateVolumeIcon(volume) {
            if (!elements.volumeIcon) return;
            let icon = 'fa-volume-up';
            if (volume === 0) icon = 'fa-volume-mute';
            else if (volume < 30) icon = 'fa-volume-off';
            else if (volume < 70) icon = 'fa-volume-down';
            elements.volumeIcon.className = `fas ${icon}`;
        }

        function syncVolume() {
            const video = elements.videoPlayer;
            const audio = elements.audioPlayer;
            const player = video?.style.display !== 'none' ? video : audio;
            if (player && elements.volumeSlider) {
                const volume = Math.round(player.volume * 100);
                if (volume !== state.volume) {
                    state.volume = volume;
                    elements.volumeSlider.value = volume;
                    updateVolumeIcon(volume);
                    if (elements.volumeValue) elements.volumeValue.textContent = `${volume}%`;
                }
            }
        }

        // ============================================
        // UTILIT√ÅRIOS DE UI
        // ============================================
        function updatePlayButton(isPlaying) {
            state.isPlaying = isPlaying;
            if (elements.playBtn) {
                const icon = elements.playBtn.querySelector('i');
                if (icon) icon.className = isPlaying ? 'fas fa-pause' : 'fas fa-play';
                elements.playBtn.setAttribute('aria-label', isPlaying ? 'Pausar' : 'Reproduzir');
            }
        }

        function enablePlayerControls() {
            ['playBtn', 'shuffleBtn', 'repeatBtn', 'playAllBtn'].forEach(id => { if (elements[id]) elements[id].disabled = false; });
            updatePlayerButtons();
        }

        function disablePlayerControls() {
            ['prevBtn', 'nextBtn', 'playBtn', 'shuffleBtn', 'repeatBtn', 'playAllBtn'].forEach(id => { if (elements[id]) elements[id].disabled = true; });
        }

        function updatePlayerButtons() {
            const hasFiles = state.mediaFiles.length > 0;
            if (elements.prevBtn) elements.prevBtn.disabled = !hasFiles || (state.currentMediaIndex <= 0 && !state.isShuffle);
            if (elements.nextBtn) elements.nextBtn.disabled = !hasFiles || (state.currentMediaIndex >= state.mediaFiles.length - 1 && !state.isShuffle && !state.isRepeat);
        }

        function updateTrackInfo(name, meta) {
            if (elements.currentTrackInfo) elements.currentTrackInfo.classList.add('active');
            if (elements.currentTrackName) elements.currentTrackName.textContent = name;
            if (elements.currentTrackMeta) elements.currentTrackMeta.textContent = meta;
        }

        function hidePlayers() {
            if (elements.videoPlayer) { elements.videoPlayer.pause(); elements.videoPlayer.src = ''; elements.videoPlayer.style.display = 'none'; }
            if (elements.audioPlayer) { elements.audioPlayer.pause(); elements.audioPlayer.src = ''; elements.audioPlayer.style.display = 'none'; }
            if (elements.embedPlayer) { elements.embedPlayer.src = ''; elements.embedPlayer.style.display = 'none'; }
            if (elements.currentTrackInfo) elements.currentTrackInfo.classList.remove('active');
        }

        function scrollToPlayer() { elements.mediaListView?.scrollIntoView({ behavior: 'smooth', block: 'start' }); }

        // ============================================
        // MODAIS
        // ============================================
        function openAddItemModal() { resetAddItemForm(); openModal(elements.addItemModal); }
        function openNewPlaylistModal() {
            if (elements.newPlaylistNameModal) elements.newPlaylistNameModal.value = '';
            if (elements.newPlaylistDescription) elements.newPlaylistDescription.value = '';
            openModal(elements.newPlaylistModal);
        }
        function openModal(modal) {
            if (!modal) return;
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
            setTimeout(() => modal.querySelector('input:not([type="file"]), textarea, select')?.focus(), 100);
        }
        function closeModal(modal) { if (!modal) return; modal.classList.remove('show'); document.body.style.overflow = ''; }
        function closeAllModals() { closeModal(elements.addItemModal); closeModal(elements.newPlaylistModal); }
        function resetAddItemForm() {
            elements.addItemForm?.reset();
            state.folderHandle = null;
            if (elements.itemType) elements.itemType.value = 'online';
            if (elements.onlineForm) elements.onlineForm.style.display = 'block';
            if (elements.localForm) elements.localForm.style.display = 'none';
            if (elements.newPlaylistInput) elements.newPlaylistInput.style.display = 'none';
            if (elements.folderStatus) { elements.folderStatus.className = 'folder-status info'; elements.folderStatus.innerHTML = '<i class="fas fa-info-circle"></i><span>Pronto...</span>'; }
            if (elements.fileListPreview) { elements.fileListPreview.style.display = 'none'; elements.fileListPreview.innerHTML = ''; }
            if (elements.urlStatus) elements.urlStatus.style.display = 'none';
            document.querySelectorAll('.validation-error').forEach(el => el.classList.remove('show'));
            loadPlaylistsToSelect();
        }
        function loadPlaylistsToSelect() {
            if (!elements.playlistSelect) return;
            elements.playlistSelect.innerHTML = '<option value="nova">+ Criar Nova Playlist</option>';
            state.playlists.forEach(playlist => { const option = document.createElement('option'); option.value = playlist.id; option.textContent = playlist.name; elements.playlistSelect.appendChild(option); });
        }

        // ============================================
        // TOASTS E LOADER
        // ============================================
        function showToast(message, type = 'success', duration = 4000) {
            const container = elements.toastContainer;
            if (!container) return;
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.setAttribute('role', 'alert');
            const icons = { success: 'fa-check-circle', error: 'fa-times-circle', warning: 'fa-exclamation-triangle', info: 'fa-info-circle' };
            const colors = { success: 'var(--success-color)', error: 'var(--danger-color)', warning: 'var(--warning-color)', info: 'var(--info-color)' };
            toast.innerHTML = `<div class="toast-icon" style="color: ${colors[type]}"><i class="fas ${icons[type]}"></i></div><div class="toast-content"><div class="toast-message">${escapeHtml(message)}</div></div><button class="toast-close" aria-label="Fechar"><i class="fas fa-times"></i></button>`;
            container.appendChild(toast);
            requestAnimationFrame(() => toast.classList.add('show'));
            const timeout = duration > 0 ? setTimeout(() => removeToast(toast), duration) : null;
            toast.querySelector('.toast-close')?.addEventListener('click', () => { if (timeout) clearTimeout(timeout); removeToast(toast); });
        }
        function removeToast(toast) { toast.classList.remove('show'); setTimeout(() => toast.remove(), 300); }
        function showLoader(text = 'Carregando...', subtext = '') { elements.loaderOverlay?.classList.add('show'); if (elements.loaderText) elements.loaderText.textContent = text; if (elements.loaderSubtext) elements.loaderSubtext.textContent = subtext; }
        function updateLoaderText(text) { if (elements.loaderText) elements.loaderText.textContent = text; }
        function hideLoader() { elements.loaderOverlay?.classList.remove('show'); }

        // ============================================
        // COMPARTILHAMENTO
        // ============================================
        function shareMedia(item) {
            if (!item || item.type !== 'online' || !item.url) { showToast('‚ö†Ô∏è Apenas links online', 'warning'); return; }
            const text = `üé¨ ${item.title}\n\n${item.description ? item.description + '\n\n' : ''}${item.url}\n\nvia Arm√°rio de M√≠dias`;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank', 'noopener,noreferrer');
            showToast('‚úÖ Abrindo WhatsApp...', 'success');
        }

        // ============================================
        // HELPERS
        // ============================================
        function isMediaFile(filename) { return isAudioFile(filename) || isVideoFile(filename); }
        function isAudioFile(filename) { return CONFIG.SUPPORTED_AUDIO.includes(filename.substring(filename.lastIndexOf('.')).toLowerCase()); }
        function isVideoFile(filename) { return CONFIG.SUPPORTED_VIDEO.includes(filename.substring(filename.lastIndexOf('.')).toLowerCase()); }
        function isVideoUrl(url) { return CONFIG.SUPPORTED_VIDEO.some(ext => url.toLowerCase().includes(ext)) || url.includes('youtube.com') || url.includes('youtu.be') || url.includes('vimeo.com'); }
        function isAudioUrl(url) { return CONFIG.SUPPORTED_AUDIO.some(ext => url.toLowerCase().includes(ext)); }
        function isValidUrl(url) { try { return ['http:', 'https:'].includes(new URL(url).protocol); } catch { return false; } }
        function getYouTubeVideoId(url) { const match = url.match(/(?:youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]{11})/); return match ? match[1] : null; }
        function getVimeoVideoId(url) { const match = url.match(/vimeo\.com\/(\d+)/); return match ? match[1] : null; }
        function formatTime(seconds) { if (!isFinite(seconds) || seconds < 0) return '0:00'; const hours = Math.floor(seconds / 3600); const mins = Math.floor((seconds % 3600) / 60); const secs = Math.floor(seconds % 60); if (hours > 0) return `${hours}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`; return `${mins}:${secs.toString().padStart(2, '0')}`; }
        function formatFileSize(bytes) { if (bytes === 0) return '0 B'; const k = 1024; const sizes = ['B', 'KB', 'MB', 'GB']; const i = Math.floor(Math.log(bytes) / Math.log(k)); return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]; }
        function escapeHtml(text) { if (!text) return ''; const div = document.createElement('div'); div.textContent = text; return div.innerHTML; }
        function generateId() { return Date.now().toString(36) + Math.random().toString(36).substr(2, 9); }
        function debounce(func, wait) { let timeout; return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => func(...args), wait); }; }
        function updatePlaylistStats() { const total = state.playlists.reduce((sum, p) => sum + p.items.length, 0); if (elements.totalItems) elements.totalItems.textContent = `${total} item(s)`; }
        function handlePlaylistListClick(e) {}
        function handleMediaListClick(e) {
            const row = e.target.closest('tr');
            if (e.target.closest('.share-btn')) { const index = parseInt(row?.dataset.index); if (!isNaN(index) && state.currentPlaylist) shareMedia(state.currentPlaylist.items[index]); return; }
            if (row) { const index = parseInt(row.dataset.index); if (!isNaN(index) && state.currentPlaylist) { const item = state.currentPlaylist.items[index]; item.type === 'online' ? playOnlineMedia(item) : playLocalFolder(item); } }
        }
        function handleMediaError(e) { console.error('Erro de m√≠dia:', e); showToast('‚ùå Erro ao carregar m√≠dia', 'error'); hideLoader(); }
    </script>
</body>
</html>
