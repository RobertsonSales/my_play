<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Arm√°rio de M√≠dias</title>
    <style>
        /* ========== ESTILOS COMPLETOS ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #6c5ce7;
            --primary-dark: #5b4cdb;
            --secondary: #00cec9;
            --accent: #fd79a8;
            --dark: #1a1a2e;
            --darker: #16213e;
            --card: #0f3460;
            --text: #eaeaea;
            --text-muted: #a0a0a0;
            --success: #00b894;
            --warning: #fdcb6e;
            --danger: #d63031;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --shadow: 0 10px 30px rgba(0,0,0,0.3);
            --shadow-lg: 0 20px 40px rgba(0,0,0,0.4);
            --bg: var(--dark);
            --bg-secondary: rgba(26, 26, 46, 0.8);
            --card-bg: var(--card);
            --border-color: rgba(255,255,255,0.1);
            --input-bg: rgba(0,0,0,0.2);
        }

        body.light-theme {
            --primary: #6c5ce7;
            --primary-dark: #5b4cdb;
            --secondary: #00b894;
            --accent: #e84342;
            --dark: #f5f6fa;
            --darker: #ffffff;
            --card: #dfe6e9;
            --text: #2d3436;
            --text-muted: #636e72;
            --bg: #f5f6fa;
            --bg-secondary: rgba(255,255,255,0.9);
            --card-bg: #ffffff;
            --border-color: rgba(0,0,0,0.1);
            --input-bg: rgba(0,0,0,0.02);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
            transition: background 0.3s, color 0.3s;
        }

        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            width: 150%;
            height: 150%;
            background: radial-gradient(circle at 20% 50%, rgba(108, 92, 231, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(0, 206, 201, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 40% 20%, rgba(253, 121, 168, 0.1) 0%, transparent 50%);
            animation: bgMove 20s ease-in-out infinite;
        }

        @keyframes bgMove {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(-5%, 5%) rotate(5deg); }
            66% { transform: translate(5%, -5%) rotate(-5deg); }
        }

        .app-container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            background: var(--bg-secondary);
            backdrop-filter: blur(20px);
            transition: opacity 0.3s;
        }

        .header {
            padding: 20px;
            background: rgba(15, 52, 96, 0.6);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .logo {
            font-size: 24px;
            font-weight: 800;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: var(--gradient-1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-text-fill-color: white;
            font-size: 18px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            border: none;
            background: rgba(255,255,255,0.05);
            color: var(--text);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
        }

        .icon-btn:hover, .icon-btn:active {
            background: var(--primary);
            transform: scale(1.05);
        }

        .search-container {
            position: relative;
        }

        .search-bar {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background: var(--input-bg);
            color: var(--text);
            font-size: 15px;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-bar:focus {
            border-color: var(--primary);
            background: rgba(0,0,0,0.3);
        }

        .search-btn {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: var(--primary);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .categories-section {
            padding: 20px;
            position: relative;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .section-title {
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            font-weight: 600;
        }

        .share-cat-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: rgba(255,255,255,0.05);
            color: var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 16px;
        }

        .share-cat-icon:hover {
            background: var(--primary);
            color: white;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .category-card {
            aspect-ratio: 1;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .category-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .category-card:hover::before, .category-card.active::before {
            opacity: 1;
        }

        .category-card.active {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(108, 92, 231, 0.4);
        }

        .cat-music { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .cat-video { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .cat-podcast { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .cat-local { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }

        .category-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .category-name {
            font-size: 11px;
            font-weight: 600;
            text-align: center;
        }

        .content-area {
            flex: 1;
            padding: 0 20px 100px;
            overflow-y: auto;
        }

        .add-item-btn, .play-all-btn {
            width: 100%;
            padding: 14px;
            margin-bottom: 20px;
            border-radius: 12px;
            border: 2px dashed rgba(108, 92, 231, 0.4);
            background: rgba(108, 92, 231, 0.1);
            color: var(--primary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .add-item-btn:hover, .play-all-btn:hover {
            background: rgba(108, 92, 231, 0.2);
            border-color: var(--primary);
        }

        .play-all-btn {
            border-style: solid;
            background: rgba(0, 206, 201, 0.1);
            border-color: rgba(0, 206, 201, 0.4);
            color: var(--secondary);
            margin-bottom: 12px;
        }

        .play-all-btn:hover {
            background: rgba(0, 206, 201, 0.2);
            border-color: var(--secondary);
        }

        .items-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .item-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .item-card::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: var(--primary);
            transform: scaleY(0);
            transition: transform 0.3s;
        }

        .item-card:hover::after, .item-card.playing::after {
            transform: scaleY(1);
        }

        .item-card.playing {
            background: rgba(108, 92, 231, 0.2);
            border-color: var(--primary);
        }

        .item-thumbnail {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: var(--darker);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .item-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .play-icon-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .item-card:hover .play-icon-overlay {
            opacity: 1;
        }

        .play-icon-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .play-icon-btn:hover {
            transform: scale(1.1);
            background: var(--secondary);
        }

        .item-info {
            flex: 1;
            min-width: 0;
        }

        .item-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--text);
        }

        .item-meta {
            font-size: 12px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .item-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            border: none;
            background: rgba(255,255,255,0.05);
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 16px;
        }

        .action-btn:hover {
            background: var(--primary);
            transform: scale(1.1);
        }

        .action-btn.delete:hover {
            background: var(--danger);
        }

        .action-btn.share:hover {
            background: var(--success);
        }

        .action-btn.edit:hover {
            background: var(--warning);
            color: black;
        }

        .action-btn.play {
            background: var(--primary);
            color: white;
        }

        .action-btn.play:hover {
            background: var(--secondary);
            transform: scale(1.1);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .player-bar {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 40px);
            max-width: 440px;
            background: rgba(15, 52, 96, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 12px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            z-index: 90;
            display: none;
        }

        .player-bar.active {
            display: block;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(100%); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        .player-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .player-thumb {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            background: var(--gradient-1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .player-info {
            flex: 1;
            min-width: 0;
        }

        .player-title {
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: white;
        }

        .player-progress {
            margin-top: 6px;
            height: 3px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            overflow: hidden;
            cursor: pointer;
        }

        .player-progress-bar {
            height: 100%;
            background: var(--secondary);
            width: 0%;
            transition: width 0.1s linear;
        }

        .player-controls {
            display: flex;
            gap: 8px;
        }

        .player-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: var(--primary);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.2s;
        }

        .player-btn:hover {
            transform: scale(1.1);
            background: var(--primary-dark);
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: rgba(15, 52, 96, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            padding: 10px 0 calc(10px + env(safe-area-inset-bottom));
            z-index: 100;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.3s;
            border: none;
            background: none;
            font-family: inherit;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-item.active .nav-icon {
            transform: translateY(-2px);
        }

        .nav-icon {
            font-size: 22px;
            transition: transform 0.3s;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 500;
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: none;
            align-items: flex-end;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .modal.active {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background: var(--darker);
            width: 100%;
            max-width: 480px;
            border-radius: 24px 24px 0 0;
            padding: 24px;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text);
        }

        .close-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.05);
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 6px;
            font-weight: 500;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background: var(--input-bg);
            color: var(--text);
            font-size: 15px;
            outline: none;
            transition: all 0.3s;
        }

        .form-input:focus, .form-select:focus {
            border-color: var(--primary);
        }

        .form-select {
            cursor: pointer;
        }

        .submit-btn {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: none;
            background: var(--gradient-1);
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(108, 92, 231, 0.3);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-input {
            position: absolute;
            left: -9999px;
        }

        .file-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 20px;
            border: 2px dashed rgba(108, 92, 231, 0.4);
            border-radius: 12px;
            background: rgba(108, 92, 231, 0.05);
            cursor: pointer;
            transition: all 0.3s;
            color: var(--primary);
            font-weight: 500;
        }

        .file-label:hover {
            background: rgba(108, 92, 231, 0.1);
            border-color: var(--primary);
        }

        .file-label.has-file {
            background: rgba(0, 206, 201, 0.1);
            border-color: var(--secondary);
            color: var(--secondary);
        }

        .search-results {
            margin-top: 20px;
        }

        .result-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid var(--border-color);
        }

        .result-item:hover {
            background: rgba(108, 92, 231, 0.1);
            border-color: rgba(108, 92, 231, 0.3);
        }

        .result-thumb {
            width: 80px;
            height: 60px;
            border-radius: 8px;
            background: var(--card);
            flex-shrink: 0;
            overflow: hidden;
        }

        .result-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .result-info {
            flex: 1;
        }

        .result-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            color: var(--text);
        }

        .result-source {
            font-size: 12px;
            color: var(--text-muted);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--card-bg);
            color: var(--text);
            padding: 12px 24px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid var(--border-color);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }

        .share-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 20px;
        }

        .share-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 16px;
            border-radius: 16px;
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s;
        }

        .share-option:hover {
            background: rgba(108, 92, 231, 0.1);
            transform: translateY(-2px);
        }

        .share-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .share-whatsapp { background: #25D366; color: white; }
        .share-copy { background: var(--primary); color: white; }
        .share-native { background: var(--secondary); color: white; }
        .share-download { background: var(--success); color: white; }
        .share-file { background: var(--accent); color: white; }

        .share-label {
            font-size: 12px;
            color: var(--text-muted);
        }

        .file-details {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .file-detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .file-detail-label {
            color: var(--text-muted);
        }

        .file-detail-value {
            color: var(--text);
            font-weight: 500;
        }

        .web-viewer-modal .modal-content {
            height: 95vh;
            max-height: none;
            border-radius: 24px 24px 0 0;
            display: flex;
            flex-direction: column;
            padding: 0;
        }

        .web-viewer-header {
            padding: 16px 20px;
            background: rgba(15, 52, 96, 0.8);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .web-viewer-title {
            flex: 1;
            font-size: 16px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: white;
        }

        .web-viewer-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.1);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .web-viewer-frame {
            flex: 1;
            width: 100%;
            border: none;
            background: white;
        }

        .web-viewer-open {
            padding: 12px 20px;
            background: var(--card);
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
        }

        .web-viewer-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            background: var(--primary);
            color: white;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .web-viewer-btn.secondary {
            background: rgba(255,255,255,0.1);
        }

        .settings-group {
            margin-bottom: 24px;
        }

        .settings-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text);
        }

        .theme-options {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .theme-btn {
            flex: 1;
            min-width: 80px;
            padding: 12px;
            border-radius: 12px;
            border: 2px solid transparent;
            background: rgba(255,255,255,0.05);
            color: var(--text);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .theme-btn.active {
            border-color: var(--primary);
            background: rgba(108, 92, 231, 0.2);
        }

        .exit-btn {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: none;
            background: var(--danger);
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .exit-btn:hover {
            opacity: 0.9;
            transform: scale(0.98);
        }

        @media (max-width: 480px) {
            .app-container {
                max-width: 100%;
            }
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body>
    <!-- TELA DE ENCERRAMENTO -->
    <div id="shutdownScreen" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark); z-index: 9999; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center;">
        <div style="font-size: 64px; margin-bottom: 20px;">üëã</div>
        <h1 style="margin-bottom: 16px; color: white;">Aplica√ß√£o encerrada</h1>
        <p style="margin-bottom: 32px; color: #aaa;">Seus dados est√£o seguros. Clique abaixo para reiniciar.</p>
        <button onclick="restartApp()" style="background: var(--primary); border: none; color: white; padding: 16px 32px; border-radius: 30px; font-size: 18px; font-weight: bold; cursor: pointer;">Reiniciar Arm√°rio de M√≠dias</button>
    </div>

    <div class="bg-animation"></div>
    
    <div class="app-container" id="appContainer">
        <header class="header">
            <div class="header-top">
                <div class="logo">
                    <div class="logo-icon">üéµ</div>
                    Arm√°rio de M√≠dias
                </div>
                <div class="header-actions">
                    <button class="icon-btn" onclick="showSearchModal()" title="Buscar na Web">üîç</button>
                    <button class="icon-btn" onclick="showAddModal()" title="Adicionar Item">‚ûï</button>
                </div>
            </div>
            <div class="search-container">
                <input type="text" class="search-bar" id="localSearch" placeholder="Buscar na sua biblioteca..." onkeyup="debouncedFilterItems()">
                <button class="search-btn" onclick="filterItemsAndCheck()">üîç</button>
            </div>
        </header>

        <section class="categories-section">
            <div class="section-header">
                <div class="section-title">Categorias</div>
                <button class="share-cat-icon" onclick="showShareCategoryModal()" title="Compartilhar categoria">üì§</button>
            </div>
            <div class="categories-grid">
                <div class="category-card cat-music active" onclick="selectCategory('music')" data-category="music">
                    <div class="category-icon">üéµ</div>
                    <div class="category-name">M√∫sicas</div>
                </div>
                <div class="category-card cat-video" onclick="selectCategory('video')" data-category="video">
                    <div class="category-icon">üé¨</div>
                    <div class="category-name">V√≠deos</div>
                </div>
                <div class="category-card cat-podcast" onclick="selectCategory('podcast')" data-category="podcast">
                    <div class="category-icon">üéôÔ∏è</div>
                    <div class="category-name">Podcasts</div>
                </div>
                <div class="category-card cat-local" onclick="selectCategory('local')" data-category="local">
                    <div class="category-icon">üìÅ</div>
                    <div class="category-name">Arquivos</div>
                </div>
            </div>
        </section>

        <main class="content-area" id="contentArea">
            <button class="add-item-btn" onclick="showAddModal()">
                <span>‚ûï</span>
                Adicionar √† categoria <span id="currentCatLabel">M√∫sicas</span>
            </button>
            
            <div id="playAllContainer" style="display: none;"></div>
            
            <div class="items-list" id="itemsList"></div>
        </main>

        <div class="player-bar" id="playerBar">
            <div class="player-content">
                <div class="player-thumb" id="playerThumb">üéµ</div>
                <div class="player-info">
                    <div class="player-title" id="playerTitle">Selecione uma m√≠dia</div>
                    <div class="player-progress" onclick="seek(event)">
                        <div class="player-progress-bar" id="progressBar"></div>
                    </div>
                </div>
                <div class="player-controls">
                    <button class="player-btn" onclick="togglePlay()" id="playBtn">‚ñ∂Ô∏è</button>
                    <button class="player-btn" onclick="stopPlayback()" style="background: var(--danger);">‚èπÔ∏è</button>
                    <button class="player-btn" onclick="playNext()" style="background: var(--secondary);" title="Pr√≥ximo">‚è≠Ô∏è</button>
                </div>
            </div>
            <audio id="audioPlayer" style="display: none;"></audio>
            <video id="videoPlayer" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 90%; max-height: 80%; z-index: 1001; border-radius: 16px; box-shadow: var(--shadow-lg);"></video>
        </div>

        <nav class="bottom-nav">
            <button class="nav-item active" onclick="showSection('library')" data-section="library">
                <span class="nav-icon">üìö</span>
                <span class="nav-label">Biblioteca</span>
            </button>
            <button class="nav-item" onclick="showSection('favorites')" data-section="favorites">
                <span class="nav-icon">‚≠ê</span>
                <span class="nav-label">Favoritos</span>
            </button>
            <button class="nav-item" onclick="sharePublicLink()">
                <span class="nav-icon">üì§</span>
                <span class="nav-label">Compartilhar App</span>
            </button>
            <button class="nav-item" onclick="showSettingsModal()" data-section="settings">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-label">Ajustes</span>
            </button>
        </nav>
    </div>

    <!-- MODAL DE ADICIONAR/EDITAR -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="addModalTitle">Adicionar Item</h2>
                <button class="close-btn" onclick="closeModal('addModal')">‚úï</button>
            </div>
            <div class="form-group">
                <label class="form-label">Tipo de M√≠dia</label>
                <select class="form-select" id="addType" onchange="toggleAddInputs()" disabled>
                    <option value="link">Link da Web</option>
                    <option value="local">Arquivo Local</option>
                </select>
            </div>
            <div id="linkInputs">
                <div class="form-group">
                    <label class="form-label">T√≠tulo</label>
                    <input type="text" class="form-input" id="itemTitle" placeholder="Nome da m√∫sica, v√≠deo...">
                </div>
                <div class="form-group">
                    <label class="form-label">URL</label>
                    <input type="url" class="form-input" id="itemUrl" placeholder="https://...">
                </div>
            </div>
            <div id="localInputs" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Selecionar Arquivo</label>
                    <div class="file-input-wrapper">
                        <input type="file" class="file-input" id="localFile" accept="audio/*,video/*" onchange="handleFileSelect(event)">
                        <label class="file-label" for="localFile" id="fileLabel">
                            <span>üìÅ</span>
                            <span id="fileLabelText">Toque para selecionar MP3, MP4...</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">T√≠tulo (opcional)</label>
                    <input type="text" class="form-input" id="localTitle" placeholder="Nome do arquivo">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Categoria</label>
                <select class="form-select" id="itemCategory">
                    <option value="music">üéµ M√∫sica</option>
                    <option value="video">üé¨ V√≠deo</option>
                    <option value="podcast">üéôÔ∏è Podcast</option>
                    <option value="local">üìÅ Arquivo Local</option>
                </select>
            </div>
            <button class="submit-btn" id="addItemBtn" onclick="saveItem()">Adicionar √† Biblioteca</button>
        </div>
    </div>

    <!-- MODAL DE BUSCA NA WEB -->
    <div class="modal" id="searchModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Buscar na Web</h2>
                <button class="close-btn" onclick="closeModal('searchModal')">‚úï</button>
            </div>
            <div class="form-group">
                <div class="search-container">
                    <input type="text" class="form-input" id="webSearchQuery" placeholder="Buscar m√∫sicas, v√≠deos, podcasts..." style="padding-right: 50px;">
                    <button class="search-btn" onclick="performWebSearch()" style="right: 8px;">üîç</button>
                </div>
            </div>
            <div class="search-results" id="searchResults"></div>
        </div>
    </div>

    <!-- MODAL DE COMPARTILHAMENTO DE ITEM (DIN√ÇMICO) -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Compartilhar</h2>
                <button class="close-btn" onclick="closeModal('shareModal')">‚úï</button>
            </div>
            <div id="shareItemInfo" style="margin-bottom: 20px; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 12px;">
                <div style="font-size: 14px; color: var(--text-muted);">Compartilhando:</div>
                <div style="font-size: 16px; font-weight: 600; margin-top: 4px;" id="shareItemTitle">T√≠tulo do Item</div>
            </div>
            <!-- Detalhes do arquivo (exibido apenas para itens locais) -->
            <div id="shareFileDetails" style="display: none;" class="file-details">
                <div class="file-detail-row">
                    <span class="file-detail-label">Nome do arquivo:</span>
                    <span class="file-detail-value" id="shareFileName"></span>
                </div>
                <div class="file-detail-row">
                    <span class="file-detail-label">Tipo:</span>
                    <span class="file-detail-value" id="shareFileType"></span>
                </div>
                <div class="file-detail-row">
                    <span class="file-detail-label">Tamanho:</span>
                    <span class="file-detail-value" id="shareFileSize"></span>
                </div>
            </div>
            <!-- Op√ß√µes de compartilhamento (ser√£o preenchidas dinamicamente) -->
            <div class="share-options" id="shareOptions"></div>
        </div>
    </div>

    <!-- MODAL DE COMPARTILHAMENTO DE CATEGORIA -->
    <div class="modal" id="shareCatModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Compartilhar Categoria</h2>
                <button class="close-btn" onclick="closeModal('shareCatModal')">‚úï</button>
            </div>
            <div class="form-group">
                <label class="form-label">Selecionar Categoria</label>
                <select class="form-select" id="shareCategorySelect">
                    <option value="music">üéµ M√∫sicas</option>
                    <option value="video">üé¨ V√≠deos</option>
                    <option value="podcast">üéôÔ∏è Podcasts</option>
                    <option value="local">üìÅ Arquivos Locais</option>
                </select>
            </div>
            <div class="share-options" style="margin-top: 20px;">
                <div class="share-option" onclick="shareCategoryViaWhatsApp()">
                    <div class="share-icon share-whatsapp">üí¨</div>
                    <span class="share-label">WhatsApp</span>
                </div>
                <div class="share-option" onclick="copyCategoryLinks()">
                    <div class="share-icon share-copy">üìã</div>
                    <span class="share-label">Copiar Lista</span>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL DE VISUALIZA√á√ÉO WEB -->
    <div class="modal web-viewer-modal" id="webViewerModal">
        <div class="modal-content">
            <div class="web-viewer-header">
                <button class="web-viewer-close" onclick="closeWebViewer()">‚úï</button>
                <div class="web-viewer-title" id="webViewerTitle">Carregando...</div>
            </div>
            <iframe class="web-viewer-frame" id="webViewerFrame" sandbox="allow-scripts allow-same-origin allow-popups allow-forms allow-presentation"></iframe>
            <div class="web-viewer-open">
                <button class="web-viewer-btn secondary" onclick="closeWebViewer()">Fechar</button>
                <button class="web-viewer-btn" onclick="openInBrowser()">
                    <span>üåê</span>
                    Abrir no Navegador
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL DE CONFIGURA√á√ïES -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Configura√ß√µes</h2>
                <button class="close-btn" onclick="closeModal('settingsModal')">‚úï</button>
            </div>
            <div class="settings-group">
                <label class="settings-label">Tema</label>
                <div class="theme-options">
                    <button class="theme-btn active" onclick="setTheme('dark')" id="themeDark">üåô Escuro</button>
                    <button class="theme-btn" onclick="setTheme('light')" id="themeLight">‚òÄÔ∏è Claro</button>
                </div>
            </div>
            <div class="settings-group">
                <label class="settings-label">Sobre</label>
                <p style="color: var(--text-muted); font-size: 14px; line-height: 1.6;">
                    Arm√°rio de M√≠dias v3.1<br>
                    Gerencie suas m√≠dias favoritas.<br>
                    Arquivos locais s√£o armazenados permanentemente no navegador.<br>
                    Agora com compartilhamento direto de arquivos!
                </p>
            </div>
            <div class="settings-group">
                <button class="exit-btn" onclick="exitApp()">
                    <span>üö™</span>
                    Encerrar Aplica√ß√£o
                </button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">
        <span id="toastIcon">‚úì</span>
        <span id="toastMessage">Opera√ß√£o realizada!</span>
    </div>

    <script>
        // ==================== CONFIGURA√á√ÉO DO INDEXEDDB ====================
        const DB_NAME = 'MediaHubDB';
        const DB_VERSION = 1;
        const STORE_NAME = 'files';
        let db = null;

        function openDB() {
            return new Promise((resolve, reject) => {
                if (db) return resolve(db);
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                request.onupgradeneeded = (event) => {
                    const d = event.target.result;
                    if (!d.objectStoreNames.contains(STORE_NAME)) {
                        d.createObjectStore(STORE_NAME, { keyPath: 'id' });
                    }
                };
            });
        }

        function saveFileToDB(fileId, file) {
            return openDB().then(db => {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction(STORE_NAME, 'readwrite');
                    const store = transaction.objectStore(STORE_NAME);
                    const fileData = {
                        id: fileId,
                        name: file.name,
                        type: file.type,
                        size: file.size,
                        data: file
                    };
                    const request = store.put(fileData);
                    request.onsuccess = () => resolve(fileId);
                    request.onerror = () => reject(request.error);
                });
            });
        }

        function getFileFromDB(fileId) {
            return openDB().then(db => {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction(STORE_NAME, 'readonly');
                    const store = transaction.objectStore(STORE_NAME);
                    const request = store.get(fileId);
                    request.onsuccess = () => {
                        if (request.result) {
                            resolve(request.result.data);
                        } else {
                            reject(new Error('Arquivo n√£o encontrado'));
                        }
                    };
                    request.onerror = () => reject(request.error);
                });
            });
        }

        function deleteFileFromDB(fileId) {
            return openDB().then(db => {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction(STORE_NAME, 'readwrite');
                    const store = transaction.objectStore(STORE_NAME);
                    const request = store.delete(fileId);
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            });
        }

        // ==================== ESTADO GLOBAL ====================
        let currentCategory = 'music';
        let currentSection = 'library';
        let items = [];
        let currentPlaying = null;
        let isPlaying = false;
        let shareItem = null;
        let currentWebUrl = null;
        let selectedFile = null;
        let editingItemId = null;
        let playlist = [];
        let playlistIndex = -1;
        let isPlaylistActive = false;

        const audioPlayer = document.getElementById('audioPlayer');
        const videoPlayer = document.getElementById('videoPlayer');
        const itemsList = document.getElementById('itemsList');
        const addItemBtn = document.getElementById('addItemBtn');
        const playAllContainer = document.getElementById('playAllContainer');
        const appContainer = document.getElementById('appContainer');
        const shutdownScreen = document.getElementById('shutdownScreen');

        let searchTimeout;
        function debouncedFilterItems() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => filterItems(), 400);
        }

        // ==================== INICIALIZA√á√ÉO ====================
        document.addEventListener('DOMContentLoaded', async () => {
            await openDB();
            loadItems();
            await loadLocalFiles();
            renderItems();
            updateCategoryLabel();
            setupEventListeners();
            setupBackgroundPlayback();
        });

        // ---------- CARREGAR ITENS (PRESERVA LINKS DA WEB) ----------
        function loadItems() {
            try {
                const stored = localStorage.getItem('mediaHub_items');
                if (stored) {
                    items = JSON.parse(stored);
                    // Apenas itens locais perdem a URL (ser√° recriada via IndexedDB)
                    items.forEach(item => {
                        if (item.isLocal) {
                            item.url = null;
                        }
                        // Itens da web mant√™m a URL intacta
                    });
                }
            } catch (e) {
                console.error('Erro ao carregar itens:', e);
                items = [];
            }
        }

        async function loadLocalFiles() {
            for (let item of items) {
                if (item.isLocal && item.fileKey) {
                    try {
                        const file = await getFileFromDB(item.fileKey);
                        const url = URL.createObjectURL(file);
                        item.url = url;
                        item.fileName = file.name;
                        item.fileType = file.type;
                        item.fileSize = file.size;
                    } catch (e) {
                        console.error('Erro ao recuperar arquivo:', e);
                        item.url = null;
                    }
                }
            }
        }

        // ---------- SALVAR ITENS (PRESERVA URL DE LINKS, REMOVE BLOB DE LOCAIS) ----------
        function saveItems() {
            try {
                const itemsToSave = items.map(item => {
                    const { url, blobUrl, ...rest } = item;
                    if (item.isLocal) {
                        return rest; // remove a URL blob
                    } else {
                        return { ...rest, url: item.url }; // mant√©m a URL original
                    }
                });
                localStorage.setItem('mediaHub_items', JSON.stringify(itemsToSave));
            } catch (e) {
                console.error('Erro ao salvar itens:', e);
            }
        }

        // ==================== REPRODU√á√ÉO EM SEGUNDO PLANO ====================
        function setupBackgroundPlayback() {
            document.addEventListener('visibilitychange', () => {
                if (document.hidden && isPlaying && currentPlaying) {
                    const isVideo = currentPlaying.category === 'video' || currentPlaying.fileType?.startsWith('video/');
                    const player = isVideo ? videoPlayer : audioPlayer;
                    if (isVideo) {
                        player.play().catch(() => {});
                    }
                }
            });

            if ('mediaSession' in navigator) {
                navigator.mediaSession.setActionHandler('play', () => togglePlay());
                navigator.mediaSession.setActionHandler('pause', () => togglePlay());
                navigator.mediaSession.setActionHandler('previoustrack', () => playPrevious());
                navigator.mediaSession.setActionHandler('nexttrack', () => playNext());
            }

            videoPlayer.addEventListener('pause', () => {
                if (document.hidden && isPlaying) {
                    videoPlayer.play().catch(() => {});
                }
            });
        }

        // ==================== ENCERRAR / REINICIAR (SEM PERDER DADOS) ====================
        function exitApp() {
            stopPlayback();
            appContainer.style.display = 'none';
            shutdownScreen.style.display = 'flex';
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
        }

        function restartApp() {
            shutdownScreen.style.display = 'none';
            appContainer.style.display = 'flex';
            renderItems();
            showToast('Bem-vindo de volta!', 'success');
        }

        // ==================== UI E CATEGORIAS ====================
        function selectCategory(category) {
            currentCategory = category;
            document.querySelectorAll('.category-card').forEach(card => {
                card.classList.remove('active');
                if (card.dataset.category === category) card.classList.add('active');
            });
            updateCategoryLabel();
            renderItems();
        }

        function updateCategoryLabel() {
            const labels = { music: 'M√∫sicas', video: 'V√≠deos', podcast: 'Podcasts', local: 'Arquivos Locais' };
            document.getElementById('currentCatLabel').textContent = labels[currentCategory];
            document.getElementById('itemCategory').value = currentCategory;
        }

        function renderItems() {
            const filtered = items.filter(item => item.category === currentCategory);
            
            if (currentCategory === 'local' && filtered.length > 0) {
                playAllContainer.style.display = 'block';
                playAllContainer.innerHTML = `
                    <button class="play-all-btn" onclick="playAllLocal()">
                        <span>‚ñ∂Ô∏è</span>
                        Reproduzir Tudo (${filtered.length} itens)
                    </button>
                `;
            } else {
                playAllContainer.style.display = 'none';
            }
            
            if (filtered.length === 0) {
                itemsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <div>Nenhum item nesta categoria</div>
                        <div style="font-size: 13px; margin-top: 8px;">Adicione m√∫sicas, v√≠deos ou arquivos locais</div>
                    </div>
                `;
                return;
            }
            
            itemsList.innerHTML = filtered.map(item => `
                <div class="item-card ${currentPlaying?.id === item.id ? 'playing' : ''}" data-id="${item.id}">
                    <div class="item-thumbnail" onclick="playItem('${item.id}')">
                        ${item.thumbnail ? `<img src="${item.thumbnail}" alt="">` : getCategoryIcon(item.category)}
                        <div class="play-icon-overlay">
                            <div class="play-icon-btn">‚ñ∂Ô∏è</div>
                        </div>
                    </div>
                    <div class="item-info" onclick="playItem('${item.id}')">
                        <div class="item-title">${escapeHtml(item.title)}</div>
                        <div class="item-meta">
                            <span>${getCategoryIcon(item.category, true)}</span>
                            <span>${formatDate(item.date)}</span>
                            ${item.isLocal ? '<span>‚Ä¢ Local</span>' : ''}
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="action-btn play" onclick="event.stopPropagation(); playItem('${item.id}')" title="Reproduzir">‚ñ∂Ô∏è</button>
                        <button class="action-btn edit" onclick="event.stopPropagation(); editItem('${item.id}')" title="Editar">‚úèÔ∏è</button>
                        <button class="action-btn share" onclick="event.stopPropagation(); showShareModal('${item.id}')" title="Compartilhar">üì§</button>
                        <button class="action-btn delete" onclick="event.stopPropagation(); deleteItem('${item.id}')" title="Excluir">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function getCategoryIcon(category, small = false) {
            const icons = { music: 'üéµ', video: 'üé¨', podcast: 'üéôÔ∏è', local: 'üìÅ' };
            return small ? icons[category] : `<span style="font-size: 24px;">${icons[category]}</span>`;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' });
        }

        // ==================== REPRODU√á√ÉO ====================
        function playItem(id) {
            const item = items.find(i => i.id === id);
            if (!item) { showToast('Item n√£o encontrado', 'error'); return; }
            if (!item.isLocal && !item.fileType) { openWebViewer(item); return; }
            if (item.isLocal && !item.url) { showToast('Arquivo local n√£o dispon√≠vel. Tente recarregar.', 'error'); return; }
            isPlaylistActive = false;
            playlist = [];
            playLocalMedia(item);
        }

        function playLocalMedia(item) {
            stopPlayback();
            currentPlaying = item;
            isPlaying = true;
            
            document.getElementById('playerBar').classList.add('active');
            document.getElementById('playerTitle').textContent = item.title;
            document.getElementById('playerThumb').textContent = getCategoryIcon(item.category, true);
            
            if (item.category === 'video' || item.fileType?.startsWith('video/')) {
                videoPlayer.src = item.url;
                videoPlayer.style.display = 'block';
                videoPlayer.play().catch(e => showToast('Erro ao reproduzir v√≠deo', 'error'));
            } else {
                audioPlayer.src = item.url;
                audioPlayer.play().catch(e => showToast('Erro ao reproduzir √°udio', 'error'));
            }
            
            updatePlayButton();
            renderItems();
        }

        function playAllLocal() {
            const filtered = items.filter(item => item.category === 'local' && item.url);
            if (filtered.length === 0) { showToast('Nenhum arquivo local dispon√≠vel', 'error'); return; }
            playlist = filtered;
            playlistIndex = 0;
            isPlaylistActive = true;
            playCurrentPlaylistItem();
        }

        function playCurrentPlaylistItem() {
            if (playlistIndex >= 0 && playlistIndex < playlist.length) {
                playLocalMedia(playlist[playlistIndex]);
            } else {
                isPlaylistActive = false;
                playlist = [];
                stopPlayback();
                showToast('Fim da playlist');
            }
        }

        function playNext() {
            if (isPlaylistActive && playlist.length > 0) {
                playlistIndex++;
                playCurrentPlaylistItem();
            }
        }

        function playPrevious() {
            if (isPlaylistActive && playlist.length > 0) {
                playlistIndex = Math.max(0, playlistIndex - 1);
                playCurrentPlaylistItem();
            }
        }

        function togglePlay() {
            if (!currentPlaying) return;
            const isVideo = currentPlaying.category === 'video' || currentPlaying.fileType?.startsWith('video/');
            const player = isVideo ? videoPlayer : audioPlayer;
            if (isPlaying) { player.pause(); isPlaying = false; }
            else { player.play(); isPlaying = true; }
            updatePlayButton();
        }

        function stopPlayback() {
            audioPlayer.pause(); audioPlayer.src = ''; audioPlayer.currentTime = 0;
            videoPlayer.pause(); videoPlayer.src = ''; videoPlayer.currentTime = 0; videoPlayer.style.display = 'none';
            isPlaying = false; currentPlaying = null;
            document.getElementById('playerBar').classList.remove('active');
            document.getElementById('progressBar').style.width = '0%';
            renderItems();
        }

        function updatePlayButton() {
            document.getElementById('playBtn').textContent = isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
        }

        function updateProgress() {
            const isVideo = currentPlaying?.category === 'video' || currentPlaying?.fileType?.startsWith('video/');
            const player = isVideo ? videoPlayer : audioPlayer;
            if (player.duration) {
                const progress = (player.currentTime / player.duration) * 100;
                document.getElementById('progressBar').style.width = progress + '%';
            }
        }

        function seek(event) {
            if (!currentPlaying) return;
            const isVideo = currentPlaying.category === 'video' || currentPlaying.fileType?.startsWith('video/');
            const player = isVideo ? videoPlayer : audioPlayer;
            const rect = event.currentTarget.getBoundingClientRect();
            const pos = (event.clientX - rect.left) / rect.width;
            if (player.duration) player.currentTime = pos * player.duration;
        }

        function closeVideoPlayer() { videoPlayer.style.display = 'none'; }

        function openWebViewer(item) {
            currentWebUrl = item.url;
            document.getElementById('webViewerTitle').textContent = item.title;
            const frame = document.getElementById('webViewerFrame');
            let embedUrl = item.url;
            if (item.url.includes('youtube.com') || item.url.includes('youtu.be')) {
                const videoId = item.url.match(/(?:v=|\/)([\w-]{11})/)?.[1];
                if (videoId) embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
            } else if (item.url.includes('vimeo.com')) {
                const videoId = item.url.match(/vimeo\.com\/(\d+)/)?.[1];
                if (videoId) embedUrl = `https://player.vimeo.com/video/${videoId}?autoplay=1`;
            } else if (item.url.includes('open.spotify.com')) {
                embedUrl = item.url.replace('open.spotify.com', 'open.spotify.com/embed');
            } else if (item.url.includes('soundcloud.com')) {
                embedUrl = `https://w.soundcloud.com/player/?url=${encodeURIComponent(item.url)}&auto_play=true`;
            }
            frame.src = embedUrl;
            document.getElementById('webViewerModal').classList.add('active');
            currentPlaying = item;
            renderItems();
        }

        function closeWebViewer() {
            document.getElementById('webViewerFrame').src = '';
            document.getElementById('webViewerModal').classList.remove('active');
            currentWebUrl = null;
            currentPlaying = null;
            renderItems();
        }

        function openInBrowser() { if (currentWebUrl) window.open(currentWebUrl, '_blank'); }

        // ==================== ADICIONAR / EDITAR ====================
        function showAddModal() {
            editingItemId = null;
            document.getElementById('addModalTitle').textContent = 'Adicionar Item';
            document.getElementById('addItemBtn').textContent = 'Adicionar √† Biblioteca';
            document.getElementById('addType').disabled = false;
            resetAddForm();
            document.getElementById('itemCategory').value = currentCategory;
            document.getElementById('addModal').classList.add('active');
        }

        function editItem(id) {
            const item = items.find(i => i.id === id);
            if (!item) { showToast('Item n√£o encontrado', 'error'); return; }
            editingItemId = id;
            document.getElementById('addModalTitle').textContent = 'Editar Item';
            document.getElementById('addItemBtn').textContent = 'Atualizar Item';
            
            if (item.isLocal) {
                document.getElementById('addType').value = 'local';
                document.getElementById('addType').disabled = true;
                document.getElementById('linkInputs').style.display = 'none';
                document.getElementById('localInputs').style.display = 'block';
                document.getElementById('localTitle').value = item.title;
                document.getElementById('localFile').disabled = true;
                document.getElementById('fileLabelText').textContent = item.fileName || 'Arquivo local';
                document.getElementById('fileLabel').classList.add('has-file');
                selectedFile = null;
            } else {
                document.getElementById('addType').value = 'link';
                document.getElementById('addType').disabled = true;
                document.getElementById('linkInputs').style.display = 'block';
                document.getElementById('localInputs').style.display = 'none';
                document.getElementById('itemTitle').value = item.title;
                document.getElementById('itemUrl').value = item.url;
            }
            document.getElementById('itemCategory').value = item.category;
            document.getElementById('addModal').classList.add('active');
        }

        function resetAddForm() {
            document.getElementById('itemTitle').value = '';
            document.getElementById('itemUrl').value = '';
            document.getElementById('localFile').value = '';
            document.getElementById('fileLabelText').textContent = 'Toque para selecionar MP3, MP4...';
            document.getElementById('fileLabel').classList.remove('has-file');
            document.getElementById('localTitle').value = '';
            selectedFile = null;
            document.getElementById('localFile').disabled = false;
            document.getElementById('addType').disabled = false;
            document.getElementById('addType').value = 'link';
            toggleAddInputs();
        }

        function toggleAddInputs() {
            const type = document.getElementById('addType').value;
            document.getElementById('linkInputs').style.display = type === 'link' ? 'block' : 'none';
            document.getElementById('localInputs').style.display = type === 'local' ? 'block' : 'none';
            if (type === 'local') document.getElementById('itemCategory').value = 'local';
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                selectedFile = file;
                document.getElementById('fileLabelText').textContent = file.name;
                document.getElementById('fileLabel').classList.add('has-file');
                const titleInput = document.getElementById('localTitle');
                if (!titleInput.value) titleInput.value = file.name.replace(/\.[^/.]+$/, "");
            } else {
                selectedFile = null;
                document.getElementById('fileLabelText').textContent = 'Toque para selecionar MP3, MP4...';
                document.getElementById('fileLabel').classList.remove('has-file');
            }
        }

        async function saveItem() {
            const type = document.getElementById('addType').value;
            const category = document.getElementById('itemCategory').value;
            addItemBtn.disabled = true;
            addItemBtn.textContent = 'Processando...';
            
            try {
                if (editingItemId) {
                    const index = items.findIndex(i => i.id === editingItemId);
                    if (index === -1) throw new Error('Item n√£o encontrado');
                    const oldItem = items[index];
                    
                    if (type === 'link') {
                        const title = document.getElementById('itemTitle').value.trim();
                        const url = document.getElementById('itemUrl').value.trim();
                        if (!title || !url) throw new Error('Preencha todos os campos');
                        oldItem.title = title;
                        oldItem.url = url;
                        oldItem.category = category;
                        oldItem.thumbnail = generateThumbnail(url);
                    } else {
                        const title = document.getElementById('localTitle').value.trim() || oldItem.fileName;
                        oldItem.title = title;
                        oldItem.category = category;
                    }
                    showToast('Item atualizado com sucesso!');
                } else {
                    let newItem = {
                        id: Date.now().toString(),
                        category: category,
                        date: new Date().toISOString(),
                        isLocal: type === 'local'
                    };
                    
                    if (type === 'link') {
                        const title = document.getElementById('itemTitle').value.trim();
                        const url = document.getElementById('itemUrl').value.trim();
                        if (!title || !url) throw new Error('Preencha todos os campos');
                        newItem.title = title;
                        newItem.url = url;
                        newItem.thumbnail = generateThumbnail(url);
                    } else {
                        if (!selectedFile) throw new Error('Selecione um arquivo');
                        const fileId = newItem.id;
                        await saveFileToDB(fileId, selectedFile);
                        const url = URL.createObjectURL(selectedFile);
                        newItem.title = document.getElementById('localTitle').value.trim() || selectedFile.name;
                        newItem.url = url;
                        newItem.fileKey = fileId;
                        newItem.fileName = selectedFile.name;
                        newItem.fileType = selectedFile.type;
                        newItem.fileSize = selectedFile.size;
                    }
                    items.push(newItem);
                    showToast('Item adicionado com sucesso!');
                }
                
                saveItems();
                closeModal('addModal');
                resetAddForm();
                if (currentCategory === category) renderItems();
                else selectCategory(category);
            } catch (error) {
                showToast('Erro: ' + error.message, 'error');
            } finally {
                addItemBtn.disabled = false;
                addItemBtn.textContent = editingItemId ? 'Atualizar Item' : 'Adicionar √† Biblioteca';
            }
        }

        function generateThumbnail(url) {
            if (url.includes('youtube.com') || url.includes('youtu.be')) {
                const videoId = url.match(/(?:v=|\/)([\w-]{11})/)?.[1];
                if (videoId) return `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`;
            }
            if (url.includes('vimeo.com')) return 'https://via.placeholder.com/80x60/667eea/ffffff?text=Video';
            return null;
        }

        // ==================== EXCLUIR ITEM ====================
        async function deleteItem(id) {
            const item = items.find(i => i.id === id);
            if (!item) { showToast('Item n√£o encontrado', 'error'); return; }
            if (!confirm(`Tem certeza que deseja excluir "${item.title}"?`)) return;
            
            try {
                if (currentPlaying?.id === id) stopPlayback();
                if (item.isLocal && item.fileKey) {
                    await deleteFileFromDB(item.fileKey);
                    if (item.url?.startsWith('blob:')) URL.revokeObjectURL(item.url);
                }
                items = items.filter(i => i.id !== id);
                saveItems();
                renderItems();
                showToast('Item exclu√≠do com sucesso!');
            } catch (error) {
                showToast('Erro ao excluir: ' + error.message, 'error');
            }
        }

        // ==================== COMPARTILHAMENTO DE ARQUIVOS LOCAIS (NOVO) ====================
        function showShareModal(itemId) {
            shareItem = items.find(i => i.id === itemId);
            if (!shareItem) { showToast('Item n√£o encontrado', 'error'); return; }
            
            document.getElementById('shareItemTitle').textContent = shareItem.title;
            
            const fileDetailsDiv = document.getElementById('shareFileDetails');
            const shareOptionsDiv = document.getElementById('shareOptions');
            
            if (shareItem.isLocal && shareItem.fileName) {
                // √â um arquivo local -> exibe detalhes e op√ß√µes de compartilhamento de arquivo
                fileDetailsDiv.style.display = 'block';
                document.getElementById('shareFileName').textContent = shareItem.fileName || 'Desconhecido';
                document.getElementById('shareFileType').textContent = shareItem.fileType || 'Desconhecido';
                
                // Formatar tamanho
                let sizeText = 'Desconhecido';
                if (shareItem.fileSize) {
                    const bytes = shareItem.fileSize;
                    if (bytes < 1024) sizeText = bytes + ' B';
                    else if (bytes < 1048576) sizeText = (bytes / 1024).toFixed(1) + ' KB';
                    else sizeText = (bytes / 1048576).toFixed(1) + ' MB';
                }
                document.getElementById('shareFileSize').textContent = sizeText;
                
                // Op√ß√µes para arquivo local
                shareOptionsDiv.innerHTML = `
                    <div class="share-option" onclick="shareLocalFile()">
                        <div class="share-icon share-file">üìÅ</div>
                        <span class="share-label">Compartilhar Arquivo</span>
                    </div>
                    <div class="share-option" onclick="downloadLocalFile()">
                        <div class="share-icon share-download">‚¨áÔ∏è</div>
                        <span class="share-label">Download</span>
                    </div>
                `;
            } else {
                // √â um link da web -> op√ß√µes originais
                fileDetailsDiv.style.display = 'none';
                shareOptionsDiv.innerHTML = `
                    <div class="share-option" onclick="shareViaWhatsApp()">
                        <div class="share-icon share-whatsapp">üí¨</div>
                        <span class="share-label">WhatsApp</span>
                    </div>
                    <div class="share-option" onclick="copyLink()">
                        <div class="share-icon share-copy">üìã</div>
                        <span class="share-label">Copiar Link</span>
                    </div>
                    <div class="share-option" onclick="shareNative()">
                        <div class="share-icon share-native">üì±</div>
                        <span class="share-label">Nativo</span>
                    </div>
                `;
            }
            
            document.getElementById('shareModal').classList.add('active');
        }

        // Compartilhar arquivo local via Web Share API (compat√≠vel com WhatsApp)
        async function shareLocalFile() {
            if (!shareItem || !shareItem.url) {
                showToast('Arquivo n√£o dispon√≠vel', 'error');
                return;
            }
            
            try {
                // Converte a blob URL em um arquivo para compartilhar
                const response = await fetch(shareItem.url);
                const blob = await response.blob();
                const file = new File([blob], shareItem.fileName || 'arquivo', { type: shareItem.fileType || 'application/octet-stream' });
                
                if (navigator.canShare && navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        files: [file],
                        title: shareItem.title,
                        text: `Compartilhado do Arm√°rio de M√≠dias`
                    });
                    showToast('Arquivo compartilhado!');
                } else {
                    // Fallback: download
                    downloadLocalFile();
                    showToast('Compartilhamento nativo n√£o suportado. O arquivo foi baixado.', 'warning');
                }
            } catch (error) {
                console.error('Erro ao compartilhar arquivo:', error);
                // Fallback: download
                downloadLocalFile();
                showToast('Erro ao compartilhar. O arquivo foi baixado.', 'error');
            }
            
            closeModal('shareModal');
        }

        // Download do arquivo local
        function downloadLocalFile() {
            if (!shareItem || !shareItem.url) {
                showToast('Arquivo n√£o dispon√≠vel', 'error');
                return;
            }
            
            const a = document.createElement('a');
            a.href = shareItem.url;
            a.download = shareItem.fileName || shareItem.title || 'download';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            showToast('Download iniciado!');
            closeModal('shareModal');
        }

        // ==================== COMPARTILHAMENTO (LINKS DA WEB) ====================
        function shareViaWhatsApp() {
            if (!shareItem) return;
            const text = `üéµ *${shareItem.title}*\n\n‚ñ∂Ô∏è ${shareItem.url}\n\nVia Arm√°rio de M√≠dias`;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
            closeModal('shareModal'); showToast('Abrindo WhatsApp...');
        }

        function copyLink() {
            if (!shareItem) return;
            navigator.clipboard.writeText(shareItem.url).then(() => {
                showToast('Link copiado!'); closeModal('shareModal');
            }).catch(() => showToast('Erro ao copiar link', 'error'));
        }

        function shareNative() {
            if (!shareItem) return;
            if (navigator.share) {
                navigator.share({ title: shareItem.title, url: shareItem.url })
                    .catch(() => showToast('Erro ao compartilhar', 'error'));
            } else showToast('Compartilhamento nativo n√£o suportado', 'error');
        }

        // ==================== COMPARTILHAMENTO DE CATEGORIA ====================
        function showShareCategoryModal() { 
            document.getElementById('shareCatModal').classList.add('active'); 
        }

        function shareCategoryViaWhatsApp() {
            const category = document.getElementById('shareCategorySelect').value;
            const categoryItems = items.filter(i => i.category === category);
            if (categoryItems.length === 0) { showToast('Esta categoria est√° vazia!', 'error'); return; }
            const labels = { music: 'üéµ M√∫sicas', video: 'üé¨ V√≠deos', podcast: 'üéôÔ∏è Podcasts', local: 'üìÅ Arquivos' };
            let text = `*${labels[category]} - Arm√°rio de M√≠dias*\n\n`;
            categoryItems.forEach((item, index) => {
                text += `${index + 1}. ${item.title}\n`;
                if (!item.isLocal) text += `‚ñ∂Ô∏è ${item.url}\n\n`;
            });
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
            closeModal('shareCatModal'); showToast('Playlist enviada ao WhatsApp!');
        }

        function copyCategoryLinks() {
            const category = document.getElementById('shareCategorySelect').value;
            const categoryItems = items.filter(i => i.category === category && !i.isLocal);
            if (categoryItems.length === 0) { showToast('Nenhum link para copiar nesta categoria!', 'error'); return; }
            const text = categoryItems.map(i => `${i.title}: ${i.url}`).join('\n\n');
            navigator.clipboard.writeText(text).then(() => {
                showToast('Links copiados!'); closeModal('shareCatModal');
            }).catch(() => showToast('Erro ao copiar links', 'error'));
        }

        // ==================== COMPARTILHAR LINK P√öBLICO DO APP ====================
        function sharePublicLink() {
            const url = 'https://robertsonsales.github.io/my_play/';
            const text = `üì± Arm√°rio de M√≠dias - Sua biblioteca de m√≠dias!\nAcesse: ${url}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
            showToast('Link do App compartilhado!');
        }

        // ==================== BUSCA NA WEB (COPIA LINK) ====================
        function showSearchModal() {
            document.getElementById('searchModal').classList.add('active');
            document.getElementById('webSearchQuery').focus();
        }

        async function performWebSearch() {
            const query = document.getElementById('webSearchQuery').value.trim();
            if (!query) return;
            
            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = '<div style="text-align: center; padding: 20px;"><div class="loading"></div></div>';
            
            setTimeout(() => {
                const mockResults = [
                    { title: `${query} - Official Video`, source: 'YouTube', thumbnail: 'https://via.placeholder.com/80x60/FF0000/FFFFFF?text=YT', url: `https://youtube.com/results?search_query=${encodeURIComponent(query)}` },
                    { title: `${query} - √Åudio Oficial`, source: 'Spotify', thumbnail: 'https://via.placeholder.com/80x60/1DB954/FFFFFF?text=SP', url: `https://open.spotify.com/search/${encodeURIComponent(query)}` },
                    { title: `Podcast sobre ${query}`, source: 'Apple Podcasts', thumbnail: 'https://via.placeholder.com/80x60/9933FF/FFFFFF?text=PC', url: `https://podcasts.apple.com/search?term=${encodeURIComponent(query)}` }
                ];
                
                resultsDiv.innerHTML = mockResults.map(result => `
                    <div class="result-item" onclick="copySearchResult('${escapeHtml(result.url)}', '${escapeHtml(result.title)}')">
                        <div class="result-thumb"><img src="${result.thumbnail}" alt=""></div>
                        <div class="result-info">
                            <div class="result-title">${escapeHtml(result.title)}</div>
                            <div class="result-source">${result.source}</div>
                        </div>
                        <button class="action-btn" style="background: var(--success);" title="Copiar link">üìã</button>
                    </div>
                `).join('');
            }, 1000);
        }

        function copySearchResult(url, title) {
            navigator.clipboard.writeText(url).then(() => {
                showToast(`Link copiado: ${title}`);
                closeModal('searchModal');
            }).catch(() => showToast('Erro ao copiar link', 'error'));
        }

        // ==================== BUSCA LOCAL + SUGEST√ÉO WEB ====================
        function filterItems() {
            const query = document.getElementById('localSearch').value.toLowerCase().trim();
            const cards = document.querySelectorAll('.item-card');
            cards.forEach(card => {
                const title = card.querySelector('.item-title')?.textContent.toLowerCase() || '';
                card.style.display = (query === '' || title.includes(query)) ? 'flex' : 'none';
            });
        }

        function filterItemsAndCheck() {
            filterItems();
            const query = document.getElementById('localSearch').value.trim();
            if (!query) return;
            const visibleCards = Array.from(document.querySelectorAll('.item-card')).filter(card => card.style.display !== 'none');
            if (visibleCards.length === 0) {
                if (confirm('Nenhum resultado encontrado na sua biblioteca. Deseja buscar na web?')) {
                    showSearchModal();
                    document.getElementById('webSearchQuery').value = query;
                    performWebSearch();
                }
            }
        }

        // ==================== CONFIGURA√á√ïES / TEMA ====================
        function showSettingsModal() {
            const currentTheme = document.body.classList.contains('light-theme') ? 'light' : 'dark';
            document.getElementById('themeDark').classList.toggle('active', currentTheme === 'dark');
            document.getElementById('themeLight').classList.toggle('active', currentTheme === 'light');
            document.getElementById('settingsModal').classList.add('active');
        }

        function setTheme(theme) {
            document.body.classList.toggle('light-theme', theme === 'light');
            document.getElementById('themeDark').classList.toggle('active', theme === 'dark');
            document.getElementById('themeLight').classList.toggle('active', theme === 'light');
            showToast(`Tema ${theme === 'light' ? 'claro' : 'escuro'} ativado`);
        }

        // ==================== EVENT LISTENERS ====================
        function setupEventListeners() {
            audioPlayer.addEventListener('timeupdate', updateProgress);
            audioPlayer.addEventListener('ended', () => {
                isPlaying = false;
                updatePlayButton();
                if (isPlaylistActive) playNext();
            });
            
            videoPlayer.addEventListener('timeupdate', updateProgress);
            videoPlayer.addEventListener('ended', () => {
                isPlaying = false;
                updatePlayButton();
                closeVideoPlayer();
                if (isPlaylistActive) playNext();
            });
            
            videoPlayer.addEventListener('click', (e) => { if (e.target === videoPlayer) togglePlay(); });

            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        if (modal.id === 'webViewerModal') closeWebViewer();
                        else closeModal(modal.id);
                    }
                });
            });

            document.getElementById('webSearchQuery')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performWebSearch();
            });
        }

        // ==================== UTILIT√ÅRIOS ====================
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = message;
            document.getElementById('toastIcon').textContent = type === 'success' ? '‚úì' : '‚úï';
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.classList.remove('active');
        }

        function showSection(section) {
            currentSection = section;
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.section === section) item.classList.add('active');
            });
            if (section === 'favorites') showToast('Favoritos - Em desenvolvimento', 'error');
            else if (section === 'settings') showSettingsModal();
        }
    </script>
</body>
</html>
